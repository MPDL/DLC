<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:fu="http://java.sun.com/jsf/composite/components/fileUpload"
	xmlns:mpdl="http://java.sun.com/jsf/composite/components/mpdl">


<ui:composition template="templates/template_v3.xhtml">

	<ui:define name="mainContent">
	<style>
	.rf-p 
	{
	/*border-style: none;*/
	float:none;
	max-width:45.666667em;
	}
	.rf-p-hdr
	{
	float:none;
	}
	</style>
	<script>
	function ajaxExecuting(data)
	{
        
        if (data.status == 'complete') {
           toggleDisplay(document.getElementById('form1:teiInfo'));
           toggleDisplay(document.getElementById('form1:imageInfo'));


   


      }

     function toggleDisplay(element) {
 //        element.style.display = element.style.display == "none" ? "" : "none"; 
     	if(document.getElementById('form1:contentModel').value == 'Multivolume')
        	element.style.display = "none";
       	else
        	element.style.display = "";
    }

      }

	</script>

		<h:panelGroup layout="block" styleClass="full_area0 fullItem">
		<h:form>	
			<rich:panel id="submit">

				
				<a4j:commandButton action="#{ingestBean.save}" value="#{lbl.btn_create}" render="messages modsInfo teiInfo imageInfo" execute="@form" onbegin="#{rich:component('popup')}.show()" oncomplete="#{rich:component('popup')}.hide()">
					<!-- <rich:componentControl event="begin" target="popup" operation="show"/>-->
				</a4j:commandButton>
				<h:commandButton action="#{ingestBean.clearAllData}" value="Clear All Data">
					<f:ajax render=":modsInfo :teiInfo :imageInfo" />
				</h:commandButton>
					
				<rich:popupPanel id="popup" modal="true" resizeable="false">
					<f:facet name="header">
						<h:outputText value="Upload in progress" />
					</f:facet>
					<f:facet name="controls">
					</f:facet>
					<p>Images are uploaded and processed</p>
					<p>Please be patient, this process may take several minutes</p>
				</rich:popupPanel>
					
	
			</rich:panel>

		
			<rich:panel id="select">

				<br/>
				<h:panelGroup >
					<h:outputText value="Type:" />
					<h:selectOneMenu id="contentModel" value="#{ingestBean.selectedContentModel}">
						<f:selectItems value="#{ingestBean.contentModelItems}" />
						<f:ajax event="change" render="select :modsInfo :teiInfo :imageInfo" />
					</h:selectOneMenu>
				</h:panelGroup>
				<h:panelGroup>
					<h:outputText value="Select Context:" />
					<h:selectOneMenu id="contextId" value="#{ingestBean.selectedContextId}">
						<f:selectItems value="#{ingestBean.contextSelectItems}" />
						<f:ajax event="change" render="select" />
					</h:selectOneMenu>
				</h:panelGroup>
				<br />
				<h:panelGroup rendered="#{ingestBean.selectedContentModel == 'Volume'}" >
					<h:outputText value="Select Multivolume:"/>
					<h:selectOneMenu value="#{ingestBean.selectedMultiVolumeId}">
						<f:selectItems value="#{ingestBean.multiVolItems}" />
					</h:selectOneMenu>	
				</h:panelGroup>
			</rich:panel>
		</h:form>


			<rich:panel id="upload" header="Upload your files...">
				<fu:fileUpload rerender="imageInfo modsInfo teiInfo" fileUploadListener="#{ingestBean.fileUploaded}">
				</fu:fileUpload>
			</rich:panel>


			<rich:panel id="modsInfo" header="Metadata Information">
				<h:outputText value="#{ingestBean.mabFile.name}" />
				<h:panelGroup layout="block" rendered="#{not empty ingestBean.mabFile}">				
					<mpdl:modsEditor_view modsMetadata="#{ingestBean.modsMetadata}"/>
				</h:panelGroup>
				<h:panelGroup layout="block" rendered="#{empty ingestBean.mabFile and ingestBean.selectedContentModel=='Multivolume'}">
					<mpdl:modsEditor_Multi modsMetadata="#{ingestBean.modsMetadata}" />
				</h:panelGroup>
				<h:panelGroup  layout="block" rendered="#{empty ingestBean.mabFile and ingestBean.selectedContentModel=='Monograph'}">
					<mpdl:modsEditor_Mono modsMetadata="#{ingestBean.modsMetadata}"/>
				</h:panelGroup>
				<h:panelGroup layout="block" rendered="#{empty ingestBean.mabFile and ingestBean.selectedContentModel=='Volume'}">
					<mpdl:modsEditor_Vol modsMetadata="#{ingestBean.modsMetadata}" />
				</h:panelGroup>
			
			</rich:panel>
			
			<rich:panel id="teiInfo" header="TEI Information" style="display:#{ingestBean.selectedContentModel == 'Multivolume' ? 'none' : ''}">
				<h:outputText
					value="#{ingestBean.teiFile.name} - Found #{ingestBean.numberOfTeiPbs} scan references" />
			</rich:panel>

			<rich:panel id="imageInfo" style="display:#{ingestBean.selectedContentModel == 'Multivolume' ? 'none' : ''}">
				<f:facet name="header">
					<h:outputText value="Uploaded Images" />
				</f:facet>
				<h:outputText value="No files currently uploaded" rendered="#{ingestBean.size==0}" />
				<rich:dataGrid columns="1" value="#{ingestBean.imageFiles}" var="file" rowKeyVar="row">
					<rich:panel bodyClass="rich-laguna-panel-no-header">
						<h:panelGrid columns="2">
							<a4j:mediaOutput element="img" mimeType="image/jpeg"
								createContent="#{ingestBean.paint}" value="#{row}"
								style="width:50px; height:50px;" cacheable="false">
							</a4j:mediaOutput>
							<h:panelGrid columns="2">
								<h:outputText value="File Name:" />
								<h:outputText value="#{file.name}" />
								<h:outputText value="File Length(bytes):" />
								<h:outputText value="#{file.size}" />
							</h:panelGrid>
						</h:panelGrid>
					</rich:panel>

				</rich:dataGrid>
				<br />
				<h:commandButton action="#{ingestBean.clearUploadedImages}" value="Clear Uploaded Images" rendered="#{ingestBean.size>0}">
					<f:ajax execute="@this" render="imageInfo" />
				</h:commandButton>
			</rich:panel>
		
			<h:messages />
		
		</h:panelGroup>

	</ui:define>


</ui:composition>

</html>
