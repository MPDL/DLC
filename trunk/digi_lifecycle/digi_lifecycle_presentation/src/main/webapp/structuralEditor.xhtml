<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:fu="http://java.sun.com/jsf/composite/components/fileUpload"
	xmlns:mpdl="http://java.sun.com/jsf/composite/components/mpdl"
	xmlns:load="http://java.sun.com/jsf/composite/components/lazyLoad"
	xmlns:pretty="http://ocpsoft.com/prettyfaces"
	xmlns:p="http://primefaces.prime.com.tr/ui"
	xmlns:structTypes="http://java.sun.com/jsf/composite/components/mpdl/structuralTypes">

	<ui:composition template="templates/template_v3.xhtml">
	<ui:define name="mainContent">

		<h:outputScript library="jscript" name="jquery_1.6.3_min.js" target="head"/>
		<h:outputScript library="components/lazyload_new" name="jquery.lazyload.js" target="head"/>

		<h:panelGroup id="thumbsContainer" layout="block" styleClass="eg3_container1_3" style="height:800px; overflow:auto">
			
			
			<a4j:repeat var="element" value="#{structuralEditorBean.flatTeiElementList}">
				
				<h:panelGroup  layout="block" styleClass="#{element.teiElement.id} eg3_container1 eg3_clearLeft" style="background-color:#{element.teiElement.id == structuralEditorBean.selectedPb.teiElement.id ? 'lightblue' : 'white'};" rendered="#{element.teiElement.elementType=='PB'}">
					<h:form>
						
						
						<h:panelGroup layout="block" styleClass="eg3_container1_2">
							<h:commandLink action="#{structuralEditorBean.selectPb(element)}" >
								
								<img src="/dlc/resources/components/lazyload_new/grey.gif" data-original="#{volumeUtilBean.getImageServerUrl(element.page.contentIds, 'THUMBNAIL')}" class="lazy" height="200"/>
								<ui:remove>
								<img src="#{volumeUtilBean.getImageServerUrl(element.page.contentIds, 'THUMBNAIL')}" class="lazy" height="200"/>
								</ui:remove>
							</h:commandLink>
							
							
							
						
						</h:panelGroup>
						
						<h:panelGroup layout="block" styleClass="eg3_container1_2" style="width:200px">
							
							<h:outputText value="#{element.page.order + 1}" />
							<h:outputText value=" / #{element.teiElement.numeration}" rendered="#{not empty element.teiElement.numeration}" />
							
							<h:outputText value=" (#{element.teiElement.type})" rendered="#{not empty element.teiElement.type}"/>
							<h:outputText value=" (#{element.teiElement.subtype})" rendered="#{not empty element.teiElement.subtype}"/>
							<br/><br/>
							
							<a4j:repeat var="wrapper" value="#{structuralEditorBean.getElementsToNextPb(element)}">
								<h:panelGroup rendered="#{wrapper.positionType == 'START'}">
									<ui:remove>
										<h:outputText  value="#{lbl.edit_start} " rendered="#{wrapper.positionType == 'START'}" />
										<h:outputText  value="#{lbl.edit_end} " rendered="#{wrapper.positionType == 'END'}" />
									</ui:remove>
									
									<h:outputText  value="#{internationalizationHelper.getLabelForEnum('structuretype_', wrapper.teiElement.type)}" rendered="#{wrapper.teiElement.elementType == 'DIV'}"/>	
									<h:outputText  value="#{lbl.edit_elementType_title_page}" rendered="#{wrapper.teiElement.elementType == 'TITLE_PAGE'}"/>
									<h:outputText  value="#{lbl.edit_elementType_figure}" rendered="#{wrapper.teiElement.elementType == 'FIGURE'}"/>
									
									<h:outputText  value=" - #{wrapper.teiElement.head[0]}" rendered="#{wrapper.teiElement.elementType == 'DIV'}"/>
									
									<h:outputText  value=" - #{wrapper.teiElement.docTitles[0].title}" rendered="#{wrapper.teiElement.elementType == 'TITLE_PAGE'}"/>
								<br/><br/>
								</h:panelGroup>
								
								
							
							</a4j:repeat>
							
							
						</h:panelGroup>
						
						
					</h:form>
					
				</h:panelGroup>
				
				<h:panelGroup layout="block" styleClass="eg3_container1 eg3_clearLeft" rendered="#{element.teiElement.elementType=='FRONT' or element.teiElement.elementType=='BODY' or element.teiElement.elementType=='BACK'}">
					<h:outputText  value="#{element.teiElement.elementType}--#{element.positionType}" />	
				</h:panelGroup>
			</a4j:repeat>
		
		</h:panelGroup>
		
		
		<script>
		$("img.lazy").lazyload({
							container: $("#thumbsContainer"),
							});
		</script>
	
		
		<h:panelGroup layout="block" id="view" styleClass="container1_3">
				<h:graphicImage id="img" value="#{volumeUtilBean.getImageServerUrl(structuralEditorBean.selectedPb.page.contentIds, 'WEB')}" />
		</h:panelGroup>
		
		
		
		
		<h:panelGroup layout="block" id="pbForm" styleClass="container1_3">
			
			<rich:panel>
			<h:form>
			
				<h:outputText value="#{lbl.edit_physicalPageNumber}: " />
				<h:outputText value="#{structuralEditorBean.selectedPb.page.order + 1}" />
				<br/>
			
			
				<h:outputText value="#{lbl.edit_currentLogicalPageNumber}: " />
				<h:outputText value="#{structuralEditorBean.selectedPb.teiElement.numeration}" />
				<br/>
				<br/>
			
				<h:outputText value="#{lbl.edit_paginationType}" />
				<h:selectOneMenu value="#{structuralEditorBean.selectedPaginationType}">
					<f:selectItem itemValue="ARABIC" itemLabel="#{lbl.edit_paginationTypeArabic}"/>
					<f:selectItem itemValue="ROMAN" itemLabel="#{lbl.edit_paginationTypeRoman}"/>
					<f:selectItem itemValue="FREE" itemLabel="#{lbl.edit_paginationTypeFree}"/>
				</h:selectOneMenu>
				<br/>
					
				<h:outputText value="#{lbl.edit_paginationStartValue}" />
				<h:inputText value="#{structuralEditorBean.selectedPaginationStartValue}"/>
				<br/>
				
				<h:outputText value="#{lbl.edit_paginationPattern}" />
				<h:inputText value="#{structuralEditorBean.selectedPaginationPattern}"/>
				<br/>
				
				<h:outputText value="#{lbl.edit_paginationEndPoint}" />
				<h:selectOneMenu value="#{structuralEditorBean.selectedPaginationEndPbId}">
					<f:selectItems value="#{structuralEditorBean.paginationEndPbSelectItems}"/>
					
				</h:selectOneMenu>
				<br/>
				
				<h:commandButton action="#{structuralEditorBean.applyPagination}" value="#{lbl.edit_applyPaginationBtn}" />
				<br/>
				<br/>
				<h:outputText value="#{lbl.edit_pageDisplayType}" />
				 <h:selectOneMenu value="#{structuralEditorBean.selectedPb.teiElement.type}">
	                  	 <f:selectItem itemValue="#{null}" itemLabel="-"/>
	                  	 <f:selectItem itemValue="single" itemLabel="#{lbl.displayType_single}"/>
	                  	 <f:selectItem itemValue="left" itemLabel="#{lbl.displayType_recto}"/>
	                  	 <f:selectItem itemValue="right" itemLabel="#{lbl.displayType_verso}"/>
	            </h:selectOneMenu>
	            
	            <br/>
	            
	            <h:outputText value="#{lbl.edit_paginationEndPoint}" />
				<h:selectOneMenu value="#{structuralEditorBean.selectedPageDisplayTypeEndPbId}">
					<f:selectItems value="#{structuralEditorBean.paginationEndPbSelectItems}"/>
					
				</h:selectOneMenu>
				<br/>
				
				<h:commandButton action="#{structuralEditorBean.applyPageDisplayType}" value="#{lbl.edit_applyPaginationDisplayTypeBtn}" />
				<br/>
	            
				
				<br/>
				<h:outputText value="#{lbl.edit_pageType}" />
				<h:selectOneMenu value="#{structuralEditorBean.selectedPb.teiElement.subtype}">
	                  	 <f:selectItem itemValue="#{null}" itemLabel="-"/>
	                  	 <f:selectItem itemValue="blank" itemLabel="#{lbl.pageType_blank}"/>
	                  	 <f:selectItem itemValue="cover" itemLabel="#{lbl.pageType_cover}"/>
	                  	 <f:selectItem itemValue="colorchart" itemLabel="#{lbl.pageType_colorchart}"/>
	                  	 <f:selectItem itemValue="edge" itemLabel="#{lbl.pageType_edge}"/>
	                  	 <f:selectItem itemValue="boardpaper" itemLabel="#{lbl.pageType_boardpaper}"/>
	                  	 <f:selectItem itemValue="endsheet" itemLabel="#{lbl.pageType_endsheet}"/>
	                  	 <f:selectItem itemValue="spine" itemLabel="#{lbl.pageType_spine}"/>	 
	               </h:selectOneMenu>
				<br/>
				<h:outputText value="#{lbl.edit_paginationEndPoint}" />
				<h:selectOneMenu value="#{structuralEditorBean.selectedPageTypeEndPbId}">
					<f:selectItems value="#{structuralEditorBean.paginationEndPbSelectItems}"/>
					
				</h:selectOneMenu>
				<br/>
				
				<h:commandButton action="#{structuralEditorBean.applyPageType}" value="#{lbl.edit_applyPageTypeBtn}" />
				<br/>
			</h:form>
			
			</rich:panel>
			
			
			
			<rich:panel>
				<h:form>
		        	 <structTypes:structuralTypeEditor selectedStructuralType="#{structuralEditorBean.selectedStructuralType}" 
		        	 structuralTypeChangeListener="#{structuralEditorBean.selectedStructuralElementTypeChanged}"
		        	 teiWrapper="#{structuralEditorBean.currentNewElement}"/>
		              <br/>
		              <br/>
		              <h:commandButton value="#{lbl.edit_createStructuralElementBtn}" action="#{structuralEditorBean.createStructuralElement}"/>
	             </h:form>
             </rich:panel>

		</h:panelGroup>
		
		
		<h:panelGroup style="height:800px">
			<h:form id="structuralEditorForm">
			<rich:tree toggleType="ajax" var="divItem" >
				<rich:treeModelRecursiveAdaptor  roots="#{structuralEditorBean.treeWrapperNodes}" nodes="#{divItem.children}">
					
					<rich:treeNode expanded="#{true}" rendered="#{divItem.teiElementWrapper.teiElement.elementType != 'PB'}">
						
						
						<h:commandButton value="Up" action="#{structuralEditorBean.moveElementUp(divItem.teiElementWrapper)}" rendered="#{divItem.teiElementWrapper.pagebreakWrapper == structuralEditorBean.selectedPb and divItem.movableUp}"/>
						<h:commandButton value="Down" action="#{structuralEditorBean.moveElementDown(divItem.teiElementWrapper)}" rendered="#{divItem.teiElementWrapper.pagebreakWrapper == structuralEditorBean.selectedPb and divItem.movableDown}"/>
						&#160;
						<h:commandButton value="&lt;&lt;" action="#{structuralEditorBean.moveElementToLeft(divItem.teiElementWrapper)}" rendered="#{divItem.teiElementWrapper.pagebreakWrapper == structuralEditorBean.selectedPb and divItem.movableToLeft}"/>
					
						
						<h:panelGroup style="#{divItem.teiElementWrapper.pagebreakWrapper == structuralEditorBean.selectedPb ? 'color:black; font-size:150%;' : 'color:grey;'}">
							<h:commandLink action="#{structuralEditorBean.selectStructuralElement(divItem.teiElementWrapper)}" style="#{divItem.invalid ? 'color:red;' : ''}" >
							<h:panelGroup rendered="#{divItem.teiElementWrapper.teiElement.elementType=='DIV'}">
								<h:outputText value="[#{internationalizationHelper.getLabelForEnum('structuretype_',divItem.teiElementWrapper.teiElement.type)}] " rendered="#{not empty divItem.teiElementWrapper.teiElement.type}"/>
								<h:outputText value="[Section] " rendered="#{empty divItem.teiElementWrapper.teiElement.type}"/>
								<h:outputText value="#{divItem.teiElementWrapper.teiElement.numeration} " rendered="#{not empty divItem.teiElementWrapper.teiElement.numeration}"/>
								<h:outputText value="#{divItem.teiElementWrapper.teiElement.author1inv}" rendered="#{not empty divItem.teiElementWrapper.teiElement.author1inv}"/>
								<h:outputText value="; #{divItem.teiElementWrapper.teiElement.author2inv}" rendered="#{not empty divItem.teiElementWrapper.teiElement.author2inv}"/>
								<h:outputText value="; #{divItem.teiElementWrapper.teiElement.author3inv}" rendered="#{not empty divItem.teiElementWrapper.teiElement.author3inv}"/>
								<h:outputText value=" : " rendered="#{(not empty divItem.teiElementWrapper.teiElement.author1inv or not empty divItem.teiElementWrapper.teiElement.author2inv or not empty divItem.teiElementWrapper.teiElement.author3inv) and not empty divItem.teiElementWrapper.teiElement.head}"/>
								<h:outputText value="#{volumeUtilBean.replaceLineBreaksWithBlanks(divItem.teiElementWrapper.teiElement.head[0])}" rendered="#{not empty divItem.teiElementWrapper.teiElement.head}"/>
							</h:panelGroup>
							
							<h:panelGroup rendered="#{divItem.teiElementWrapper.teiElement.elementType=='FRONT' or divItem.teiElementWrapper.teiElement.elementType=='BODY' or divItem.teiElementWrapper.teiElement.elementType=='BACK'}">
								<h:outputText value="#{divItem.teiElementWrapper.teiElement.elementType}"/>
							</h:panelGroup>
							
							<h:panelGroup rendered="#{divItem.teiElementWrapper.teiElement.elementType=='FIGURE'}">
								<h:outputText value="[#{divItem.teiElementWrapper.teiElement.elementType}]"/>
							
							</h:panelGroup>
							
							
						<h:panelGroup rendered="#{divItem.teiElementWrapper.teiElement.elementType=='TITLE_PAGE'}">
							
							<h:outputText value="[#{lbl.edit_elementType_title_page}] "/>
							<h:outputText value="#{volumeUtilBean.replaceLineBreaksWithBlanks(divItem.teiElementWrapper.teiElement.docTitles[0].title)}"/>
						</h:panelGroup>
						</h:commandLink>
						
						<h:outputText value=" (#{divItem.teiElementWrapper.pagebreakWrapper.page.order + 1} / #{divItem.teiElementWrapper.pagebreakWrapper.page.orderLabel} - "/>
						
						<h:outputText value="#{divItem.teiElementWrapper.partnerElement.pagebreakWrapper.page.order + 1} / #{divItem.teiElementWrapper.partnerElement.pagebreakWrapper.page.orderLabel}" rendered="#{divItem.teiElementWrapper.pagebreakWrapper != structuralEditorBean.selectedPb or divItem.teiElementWrapper.teiElement.elementType=='FRONT' or divItem.teiElementWrapper.teiElement.elementType=='BODY' or divItem.teiElementWrapper.teiElement.elementType=='BACK'}"/>
						
						
						
						
						<h:selectOneMenu value="#{divItem.teiElementWrapper.partnerElement.pagebreakIdToMoveTo}" rendered= "#{divItem.teiElementWrapper.pagebreakWrapper == structuralEditorBean.selectedPb and divItem.teiElementWrapper.teiElement.elementType!='FRONT' and divItem.teiElementWrapper.teiElement.elementType!='BODY' and divItem.teiElementWrapper.teiElement.elementType!='BACK'}">
							<f:selectItems value="#{structuralEditorBean.getEndPagesSelectItemsForElement(divItem.teiElementWrapper)}"/>
							<f:ajax event="change" listener="#{structuralEditorBean.moveEndPageTo(divItem.teiElementWrapper, divItem.teiElementWrapper.partnerElement.pagebreakIdToMoveTo)}" render="@all"/>
						</h:selectOneMenu>
						
						<h:outputText value=")"/>
						
						</h:panelGroup>
						
						
						<h:commandButton value="&gt;&gt;" action="#{structuralEditorBean.moveElementToRight(divItem.teiElementWrapper)}" rendered="#{divItem.teiElementWrapper.pagebreakWrapper == structuralEditorBean.selectedPb and divItem.movableToRight}"/>
					
						<h:commandButton action="#{structuralEditorBean.deleteStructuralElement(divItem.teiElementWrapper)}" value="Delete" rendered="#{divItem.teiElementWrapper.pagebreakWrapper == structuralEditorBean.selectedPb and divItem.teiElementWrapper.teiElement.elementType!='FRONT' and divItem.teiElementWrapper.teiElement.elementType!='BODY' and divItem.teiElementWrapper.teiElement.elementType!='BACK'}"/>
						
						
						<a4j:commandButton render="editPopup" action="#{structuralEditorBean.editStructuralElement(divItem.teiElementWrapper)}"  oncomplete="#{rich:component('editPopup')}.show()" value="Edit" rendered="#{divItem.teiElementWrapper.pagebreakWrapper == structuralEditorBean.selectedPb and divItem.teiElementWrapper.teiElement.elementType!='FRONT' and divItem.teiElementWrapper.teiElement.elementType!='BODY' and divItem.teiElementWrapper.teiElement.elementType!='BACK'}" />
						
					</rich:treeNode>
					
				</rich:treeModelRecursiveAdaptor>
			</rich:tree>
			
			
		</h:form>

		</h:panelGroup>
		
		
		<rich:popupPanel id="editPopup" modal="true" resizeable="false" domElementAttachment="form">
				<f:facet name="header">
					<h:outputText value="Edit" />
				</f:facet>
				<f:facet name="controls">
				</f:facet>
				<h:form>
	        	 <structTypes:structuralTypeEditor selectedStructuralType="#{structuralEditorBean.selectedStructuralType}" 
	        	 structuralTypeChangeListener="#{structuralEditorBean.selectedStructuralEditElementTypeChanged}"
	        	 teiWrapper="#{structuralEditorBean.currentEditElementWrapper}"/>
	              <br/>
	              <br/>
	              
	              <h:commandButton type="submit" value="#{lbl.edit_updateStructuralElementBtn}" action="#{structuralEditorBean.updateEditedStructuralElement}"/>
	              
	              <h:outputLink value="#" onclick="#{rich:component('editPopup')}.hide()">
	              	<h:outputText value="Cancel" />
	              </h:outputLink>
	              </h:form>
			</rich:popupPanel>
		
		<h:panelGroup layout="block" styleClass="eg3_container1">
			<h:form>
				<h:commandButton value="Save" action="#{structuralEditorBean.save}"/><br/>
				<h:commandButton value="Save &amp; Release" action="#{structuralEditorBean.saveAndRelease}"/>
			</h:form>
		</h:panelGroup>
		
		
		<rich:panel header="Validation Errors">
				
				<ul style="color:red;">
				<a4j:repeat var="validation" value="#{structuralEditorBean.validationList}">
					<li>
					<h:outputText value="#{internationalizationHelper.getLabelForEnum('edit_elementType_', validation.affectedNode.teiElementWrapper.teiElement.elementType)}" />
					<h:outputText value=" cannot be placed under " />
					<h:outputText value="#{internationalizationHelper.getLabelForEnum('edit_elementType_', validation.affectedNode.parent.teiElementWrapper.teiElement.elementType)}" />
					</li>
				</a4j:repeat>
				</ul>
        </rich:panel>
		
		<script>
		
			$(document).ready(function(e)
					{
						scrollDivs();
					});
			
			function scrollDivs()
			{
				var selectedPb = '#{structuralEditorBean.selectedPb.teiElement.id}';
				//var selectedPb = 'page_300';
				var pos = $('.' + selectedPb).position();
				var thumbsContainerPos = $('#thumbsContainer').position();
				var currentScroll = $('#thumbsContainer').scrollTop();
				$('#thumbsContainer').scrollTop(pos.top + currentScroll - thumbsContainerPos.top);

			}
		
		
			
		
		
		
		</script>
			
		
		</ui:define>
		
		
	</ui:composition>

</html>
