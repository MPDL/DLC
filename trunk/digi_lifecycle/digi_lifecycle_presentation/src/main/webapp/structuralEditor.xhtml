<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:fu="http://java.sun.com/jsf/composite/components/fileUpload"
	xmlns:mpdl="http://java.sun.com/jsf/composite/components/mpdl"
	xmlns:load="http://java.sun.com/jsf/composite/components/lazyLoad"
	xmlns:pretty="http://ocpsoft.com/prettyfaces"
	xmlns:p="http://primefaces.prime.com.tr/ui"
	xmlns:structTypes="http://java.sun.com/jsf/composite/components/mpdl/structuralTypes"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

	<ui:composition template="templates/template_v3.xhtml">
		<ui:define name="separateContentHeader">
			<h:panelGroup layout="block" styleClass="eg3_container_1_2 eg3_viewPageHeader">
				<h:panelGroup layout="block" styleClass="eg3_container_1">
					<h:panelGroup layout="block" styleClass="eg3_detailItemHeader">
						<h3 class="eg3_multiVolumeTitle">
							<h:outputText value="#{viewPages.context.properties.name}"/> 
						</h3>
						<h:panelGroup styleClass="eg3_floatLeft">
							<h3 class="eg3_volumeTitle"><h:outputText value="#{volumeUtilBean.getTitle(structuralEditorBean.volume.modsMetadata).title}"/></h3>
							<h4 class="eg3_volumeDetails"><h:outputText value="#{volumeUtilBean.getFirstEditor(structuralEditorBean.volume.modsMetadata).name}"/></h4>
						</h:panelGroup>
					</h:panelGroup>
				</h:panelGroup>
			</h:panelGroup>
		</ui:define>
	
	
		<ui:define name="mainContent">
	
			<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_viewPageContainer">
				
				<!-- BEGIN THUMBNAIL LIST -->
				<h:panelGroup  layout="block" styleClass="eg3_id_sidebarLeft eg3_container_1_4">
				
					<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_sidebarEmptyContentHeader">
						<h:outputText value="&#160;"/>
					</h:panelGroup>
					
					
					<h:panelGroup id="thumbsContainer" layout="block" styleClass="eg3_container_1 eg3_editSidebarContent" style="min-height:800px;">
						<a4j:repeat id="thumbsRepeater" var="element" value="#{structuralEditorBean.pbList}">
							
							<h:panelGroup id="thumbsContent" layout="block" styleClass="#{element.teiElement.id} eg3_container_1 eg3_editSidebarContentItem"  style="background-color:#{element.teiElement.id == structuralEditorBean.selectedPb.teiElement.id ? 'lightblue' : 'white'};" rendered="#{element.teiElement.elementType=='PB'}">
								<h:outputText value="#{structuralEditorBean.addToClientIdMap(element.teiElement.id, component.parent.clientId)}"/>
								<h:form id="thumbsForm">
									<h:panelGroup layout="block" styleClass="eg3_container_1_2 eg3_sidebarThumbnail" >
										<h:commandLink action="#{structuralEditorBean.selectPb(element)}" >
											<img src="#{volumeUtilBean.getImageServerUrl(element.page.contentIds, 'THUMBNAIL')}"/>
											<f:ajax render=":messages :edit :paginator" execute="@this"/>
										</h:commandLink>
									</h:panelGroup>
									</h:form>
									<h:panelGroup id="thumbsDescription" layout="block" styleClass="eg3_container_1_2" >
										<b>
										<h:outputText value="#{lbl.edit_scan} #{element.page.order + 1}" />
										<h:outputText value=" / #{lbl.edit_page} #{element.teiElement.numeration}" rendered="#{not empty element.teiElement.numeration}" />
										</b>
										<h:outputText value=" (#{internationalizationHelper.getLabelForEnum('pageType_', element.teiElement.subtype)})" rendered="#{not empty element.teiElement.subtype}"/>
										<h:panelGroup rendered="#{not empty element.teiElement.type}">
											<h:outputText value=" (#{lbl.displayType_single})" rendered="#{element.teiElement.type=='single'}"/>
											<h:outputText value=" (#{lbl.displayType_recto})" rendered="#{element.teiElement.type=='left'}"/>
											<h:outputText value=" (#{lbl.displayType_verso})" rendered="#{element.teiElement.type=='right'}"/>
										</h:panelGroup>
										
										<br/><br/>
										
										
										<a4j:repeat var="wrapper" value="#{structuralEditorBean.getElementsToNextPb(element)}">
											<h:panelGroup rendered="#{wrapper.positionType == 'START'}">
												<ui:remove>
													<h:outputText  value="#{lbl.edit_start} " rendered="#{wrapper.positionType == 'START'}" />
													<h:outputText  value="#{lbl.edit_end} " rendered="#{wrapper.positionType == 'END'}" />
												</ui:remove>
												
												<h:outputText  value="#{internationalizationHelper.getLabelForEnum('structuretype_', wrapper.teiElement.type)}" rendered="#{wrapper.teiElement.elementType == 'DIV'}"/>	
												<h:outputText  value="#{lbl.edit_elementType_title_page}" rendered="#{wrapper.teiElement.elementType == 'TITLE_PAGE'}"/>
												<h:outputText  value="#{lbl.edit_elementType_figure}" rendered="#{wrapper.teiElement.elementType == 'FIGURE'}"/>
												
												<h:outputText  value=" #{wrapper.teiElement.numeration}" rendered="#{not empty wrapper.teiElement.numeration}"/>
												<h:outputText  value=" - #{wrapper.teiElement.head[0]}" rendered="#{wrapper.teiElement.elementType == 'DIV' or wrapper.teiElement.elementType == 'FIGURE'}"/>
												
												<h:outputText  value=" - #{wrapper.teiElement.docTitles[0].title}" rendered="#{wrapper.teiElement.elementType == 'TITLE_PAGE'}"/>
											<br/><br/>
											</h:panelGroup>
									
										</a4j:repeat>
										
									</h:panelGroup>	
								
								
							</h:panelGroup>
							
							<ui:remove>
							<h:panelGroup id="frontBodyBack" layout="block" styleClass="eg3_container_1 eg3_clearLeft" rendered="#{element.teiElement.elementType=='FRONT' or element.teiElement.elementType=='BODY' or element.teiElement.elementType=='BACK'}">
								<h:outputText  value="#{element.teiElement.elementType}--#{element.positionType}" />	
							</h:panelGroup>
							</ui:remove>

						</a4j:repeat>
					</h:panelGroup>
				
					
					
				
					
					
				</h:panelGroup>
				
				
				<!-- END THUMBNAIL LIST -->
				
				
				<!-- START PAGE IMAGE -->
				<h:panelGroup id="view" layout="block" styleClass="eg3_container_3_4 eg3_viewPage">
					<h:panelGroup id="paginator" layout="block" styleClass="eg3_viewPageMenu">
						<h:panelGroup layout="block" styleClass="eg3_container_1_4">
							<h:outputText value="#{structuralEditorBean.selectedPb.teiElement.numeration}"/>
							<h:outputText value="&#160;" rendered="#{empty structuralEditorBean.selectedPb.teiElement.numeration}"/>
						</h:panelGroup>
						<h:panelGroup id="pageBrowser" layout="block" styleClass="eg3_container_1_2 eg3_textCenter">
							<h:form styleClass="eg3_pageBrowser">
								<ui:fragment rendered="#{structuralEditorBean.selectedPb.page.order > 0}">
									<h:commandLink action="#{structuralEditorBean.goToFirstPage}" title="#{tlt.paginator_goToFirstPage}">
										<h:panelGroup styleClass="eg3_icon_skipTofirst_16_16">&#160;</h:panelGroup>
										<f:ajax render=":messages :edit :paginator"/>
									</h:commandLink>
									<h:commandLink action="#{structuralEditorBean.goToPreviousPage}" title="#{tlt.paginator_goToPreviousPage}">
										<h:panelGroup styleClass="eg3_icon_backward_16_16">&#160;</h:panelGroup>
										<f:ajax render=":messages :edit :paginator"/>
									</h:commandLink>
								</ui:fragment>
								
								<h:outputText value="#{lbl.list_Scan} #{structuralEditorBean.selectedPb.page.order+1}"/>
								<h:outputText value=" / "/>
								<h:outputText value="#{structuralEditorBean.volume.pages.size()}"/>
								
								
								<ui:fragment rendered="#{structuralEditorBean.volume.pages.size() > 1}">
									<input type="button" onclick="eg3_switchInputType('.eg3_viewPageMenu .eg3_pageBrowser', '.eg3_gotoBox', true);" class="eg3_icon_editBtn_16_16"/>
								</ui:fragment>
								
								<ui:fragment rendered="#{structuralEditorBean.selectedPb.page.order + 1 lt structuralEditorBean.volume.pages.size()}">
									<h:commandLink action="#{structuralEditorBean.goToNextPage}" title="#{tlt.paginator_goToNextPage}" >
										<h:panelGroup styleClass="eg3_icon_forward_16_16"/>
										<f:ajax render=":messages :edit :paginator"/>
										
									</h:commandLink>
									<h:commandLink action="#{structuralEditorBean.goToLastPage}" title="#{tlt.paginator_goToLastPage}">
										<h:panelGroup styleClass="eg3_icon_skipTolast_16_16"/>
										<f:ajax render=":messages :edit :paginator"/>
									</h:commandLink>
								</ui:fragment>
							</h:form>
						
							<h:form styleClass="eg3_gotoBox" rendered="#{structuralEditorBean.volume.pages.size() > 1}">
								<h:selectOneMenu value="#{structuralEditorBean.selectedGoToBoxPageId}" >
							   			<f:ajax event="change" listener="#{structuralEditorBean.pageNumberChanged}" render=":messages :edit :paginator"/>
							   			<f:selectItems value="#{structuralEditorBean.pageListMenu}" />
							   		</h:selectOneMenu>
								<ui:remove>
								<input class="eg3_gotoInput eg3_borderradius_5_bottom eg3_borderradius_5_top" title="#{tlt.paginator_goToPage}" placeholder="#{structuralEditorBean.selectedPb.page.order+1}" min="1" max="99999" maxlength="5" type="number"/>
								<label class="eg3_inputLabel">
									<h:outputText value="von #{structuralEditorBean.volume.pages.size()}" />
								</label>
								</ui:remove>
							</h:form>
						</h:panelGroup>
					</h:panelGroup> <!-- END VIEWPAGEMENU -->
						
						<style type="text/css">
							.rf-tbp.eg3_container_1 .rf-tab-cnt {
								width:95.5%;
								padding:2%;
							}
						</style>
						
						<h:panelGroup id="edit" layout="block" styleClass="eg3_singleEdit">
							
							<!-- Add script here, because it has to be updated with every ajax request -->
							<script type="text/javascript">
							 /* <![CDATA[ */
								function scrollThumbsContainer()
								{
									var selectedPb = '#{structuralEditorBean.selectedPb.teiElement.id}';
									scrollDiv("thumbsContainer", selectedPb);
								}
								
								function scrollTreeContainer()
								{
									
									var selectedPbId = '#{structuralEditorBean.treeScrollPositionPagebreak.teiElement.id}';
									var treeContainerId = "#{rich:clientId('tree')}";
									scrollDiv(treeContainerId, "struct_" + selectedPbId)

								}
								
								
								function scrollDiv(containerId, scrollToClassId)
								{

									if(containerId && scrollToClassId)
									{
										//add an backslahs before all colons					
										containerId = containerId.replace(/:/g, "\\:");
										var containerDiv = $('#' + containerId);
										var scrollToElement = $('.' + scrollToClassId);

										var pos = scrollToElement.offset();
										if(pos!=null)
										{
											var containerPos = containerDiv.offset();				
											var currentScroll = containerDiv.scrollTop();				
											var newScrollPos = pos.top - containerPos.top + currentScroll - 50;		
											containerDiv.scrollTop(newScrollPos);
										}		
									}

								}
								
								$(document).ready(function(e)
										{
											scrollThumbsContainer();
											scrollTreeContainer();
										});
										
								jsf.ajax.addOnEvent(function(e)
								{	
									
									//if the ajax request is success
									//scroll to the right position in sidebar and delete the min-height value of the global parent container for dynamical browser behaviour
									if(e.status=="success")
									{
										//console.log("success");
										scrollThumbsContainer();
										scrollTreeContainer();
									}
								});
								 /* ]]> */
							</script>
							
							<h:panelGroup id="pageScan" layout="block" styleClass="eg3_container_1_2 eg3_editPage_imgContainer eg3_image_bgColor_1">
								<h:graphicImage id="img" value="#{volumeUtilBean.getImageServerUrl(structuralEditorBean.selectedPb.page.contentIds, 'WEB')}" />
								<script type="text/javascript">
									$('.eg3_editSidebarContent').css("height", $('.eg3_editPage_imgContainer').height());
								</script>
							</h:panelGroup>
							<!-- END PAGE IMAGE -->
							
							<h:panelGroup id="editingTab" layout="block" styleClass="eg3_container_1_2 eg3_editContent">
								<!-- START TAB-PANEL -->
									<h:form>
									<!-- START SAVE BUTTONS -->
									<h:panelGroup layout="block" styleClass="eg3_floatRight eg3_editActionButtonbar">
											<h:commandButton  value="#{lbl.button_command_save}" action="#{structuralEditorBean.save}" styleClass="eg3_borderradius_5"/>
											<h:outputText value="&#160;"/>
											<h:commandButton  value="#{lbl.button_command_save_and_release}" action="#{structuralEditorBean.saveAndRelease}" styleClass="eg3_borderradius_5"/>
											<h:outputText value="&#160;"/>
											<h:commandButton  value="#{lbl.button_command_revert}" action="#{structuralEditorBean.revert}" styleClass="eg3_borderradius_5"/>
									</h:panelGroup>
									</h:form>
									<!-- END SAVE BUTTONS -->
								
									
									<h:form>
									<rich:tabPanel styleClass="eg3_container_1" switchType="ajax">				

										<rich:tab header="#{lbl.edit_tab_structure_head}" label="structure" id="structure">
											<!-- START CREATE STRUCTURE ELEMENT -->
											<a4j:region>
											<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_pageEditingContainer">
												<h3><h:outputText value="#{lbl.edit_tab_structure_head}"/></h3>
												
												
												<div class="eg3_currentPageNumbers">
													<h:outputText value="#{lbl.edit_on} #{lbl.edit_scan} "/>
													<h:outputText value="#{structuralEditorBean.selectedPb.page.order + 1}"/>
													<h:outputText value=" / #{lbl.edit_page} #{structuralEditorBean.selectedPb.teiElement.numeration}" rendered="#{not empty structuralEditorBean.selectedPb.teiElement.numeration}"/>
													<h:outputText value=" / #{lbl.edit_page} -" rendered="#{empty structuralEditorBean.selectedPb.teiElement.numeration}"/>
												</div>
												<br/>
												<br/>
												
												<structTypes:structuralTypeEditor selectedStructuralType="#{structuralEditorBean.selectedStructuralType}" 
													structuralTypeChangeListener="#{structuralEditorBean.selectedStructuralElementTypeChanged}"
													teiWrapper="#{structuralEditorBean.currentNewElement}"/>
												<br/>
												<br/>
												<h:commandButton type="submit" styleClass="eg3_floatRight" value="#{lbl.edit_createStructuralElementBtn}" action="#{structuralEditorBean.createStructuralElement}">
													<f:ajax render=":messages :edit :paginator" execute="@form"/>
												</h:commandButton>
											</h:panelGroup>
											</a4j:region>
											
											<!-- END CREATE STRUCTURE ELEMENT -->
										</rich:tab>
										
										<ui:remove>
										<rich:tab header="#{lbl.edit_tab_editStructure}" label="edit_structure" id="edit_structure" rendered="#{structuralEditorBean.currentEditElementWrapper!=null}">
											<!-- START EDIT STRUCTURE ELEMENT -->
											<a4j:region>
											<style type="text/css"> .xxx input { background-color:#990099;}</style>
											<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_pageEditingContainer xxx">
												<h3><h:outputText value="#{lbl.edit_tab_editStructure_head}"/></h3>
												
												
												
												<structTypes:structuralTypeEditor selectedStructuralType="#{structuralEditorBean.selectedStructuralEditType}" 
													structuralTypeChangeListener="#{structuralEditorBean.selectedStructuralEditElementTypeChanged}"
													teiWrapper="#{structuralEditorBean.currentEditElementWrapper}"/>
												<br/>
												<br/>
												<h:commandButton type="submit" styleClass="eg3_floatRight" value="#{lbl.edit_updateStructuralElementBtn}" action="#{structuralEditorBean.updateEditedStructuralElement}">
													<f:ajax render=":messages :edit :paginator" execute="@form"/>
												</h:commandButton>
												<h:commandButton type="submit" styleClass="eg3_floatRight" value="#{lbl.edit_cancelBtn}" action="#{structuralEditorBean.cancelEditStructuralElement}">
													<f:ajax render=":messages :edit :paginator" execute="@form"/>
												</h:commandButton>
											</h:panelGroup>
											</a4j:region>
											
											<!-- END EDIT STRUCTURE ELEMENT -->
										</rich:tab>
										</ui:remove>
										
										<rich:tab header="#{lbl.edit_tab_pagination}" label="pagination" id="pagination">
											<!-- START PAGE EDITING -->
											
											<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_pageEditingContainer">
												<h3><h:outputText value="#{lbl.edit_tab_pagination_head}"/></h3>
													
													<h:panelGroup layout="block" id="currentPageValues" styleClass="eg3_currentPageNumbers">
													<a4j:region>
														<h:outputText value="#{lbl.edit_physicalPageNumber}: "/>
														<h:outputText value="#{structuralEditorBean.selectedPb.page.order + 1}"/>
														
														<br/>
														
														<h:outputText value="#{lbl.edit_currentLogicalPageNumber}: "/>
														<h:inputText value="#{structuralEditorBean.selectedPbNumeration}"/>
														
														<br/>
														<div class="eg3_editInputArea">
															<h:outputText value="#{lbl.edit_pageDisplayType}: " />
															<h:selectOneMenu value="#{structuralEditorBean.selectedPbType}">
																<f:selectItem itemValue="#{null}" itemLabel="-"/>
																<f:selectItem itemValue="single" itemLabel="#{lbl.displayType_single}"/>
																<f:selectItem itemValue="left" itemLabel="#{lbl.displayType_recto}"/>
																<f:selectItem itemValue="right" itemLabel="#{lbl.displayType_verso}"/>
															</h:selectOneMenu>
											            </div>
											            
											            <br/>
											            <div class="eg3_editInputArea">
															<h:outputText value="#{lbl.edit_pageType}: " />
															<h:selectOneMenu value="#{structuralEditorBean.selectedPbSubtype}">
																<f:selectItem itemValue="#{null}" itemLabel="-"/>
																<f:selectItem itemValue="blank" itemLabel="#{lbl.pageType_blank}"/>
																<f:selectItem itemValue="cover" itemLabel="#{lbl.pageType_cover}"/>
																<f:selectItem itemValue="colorchart" itemLabel="#{lbl.pageType_colorchart}"/>
																<f:selectItem itemValue="edge" itemLabel="#{lbl.pageType_edge}"/>
																<f:selectItem itemValue="boardpaper" itemLabel="#{lbl.pageType_boardpaper}"/>
																<f:selectItem itemValue="endsheet" itemLabel="#{lbl.pageType_endsheet}"/>
																<f:selectItem itemValue="spine" itemLabel="#{lbl.pageType_spine}"/>	 
															</h:selectOneMenu>
														</div>
											            <br/>
											            <h:commandButton action="#{structuralEditorBean.applyPageValues}" value="#{lbl.edit_apply}" >
															<f:ajax render=":messages :edit :paginator" execute="currentPageValues"/>
														</h:commandButton>
														</a4j:region>
													</h:panelGroup>
													<br/>
													<br/>
													<a4j:region>
													
													
													<br/>
													<br/>
													<br/>
													
													<h3><h:outputText value="#{lbl.edit_batchPagination}"/></h3>
													<div class="eg3_paginationInputArea">
														<div class="eg3_editInputArea">
															<h:outputText value="#{lbl.edit_paginationType}" />
															<br/>
															<h:selectOneMenu value="#{structuralEditorBean.selectedPaginationType}">
																<f:selectItem itemValue="ARABIC" itemLabel="#{lbl.edit_paginationTypeArabic}"/>
																<f:selectItem itemValue="ROMAN" itemLabel="#{lbl.edit_paginationTypeRoman}"/>
																<f:selectItem itemValue="ROMAN_MINUSCULE" itemLabel="#{lbl.edit_paginationTypeRomanMinuscule}"/>
																<f:selectItem itemValue="RECTO_VERSO" itemLabel="#{lbl.edit_paginationTypeRectoVerso}"/>
																<f:selectItem itemValue="FREE" itemLabel="#{lbl.edit_paginationTypeFree}"/>
																<f:ajax render=":messages @form" listener="#{structuralEditorBean.selectedPaginationTypeChanged}"/>
															</h:selectOneMenu>
														</div>
														
														<div class="eg3_editInputArea">
															<h:outputText value="#{lbl.edit_paginationStartValue}" />
															<br/>
															<h:inputText value="#{structuralEditorBean.selectedPaginationStartValue}"/>
														</div>
														<ui:remove>
														<div class="eg3_editInputArea">
															<h:outputText value="#{lbl.edit_paginationPattern}" />
															<br />
															<h:inputText value="#{structuralEditorBean.selectedPaginationPattern}"/>
														</div>
														</ui:remove>
														
														<h:panelGroup layout="block" styleClass="eg3_editInputArea" rendered="#{structuralEditorBean.selectedPaginationType=='ARABIC' or structuralEditorBean.selectedPaginationType =='ROMAN' or structuralEditorBean.selectedPaginationType =='ROMAN_MINUSCULE'}">
															<h:outputText value="#{lbl.edit_paginationColumns}" />
															<br/>
															<h:selectOneMenu value="#{structuralEditorBean.selectedPaginationColumns}">
																<f:selectItem itemValue="1" itemLabel="#{lbl.edit_pagination1Columns}"/>
																<f:selectItem itemValue="2" itemLabel="#{lbl.edit_pagination2Columns}"/>
																<f:selectItem itemValue="3" itemLabel="#{lbl.edit_pagination3Columns}"/>
															</h:selectOneMenu>
														</h:panelGroup>
														
														<div class="eg3_editInputArea">
															<h:outputText value="#{lbl.edit_paginationInBrackets}" />
															<br />
															<h:selectBooleanCheckbox value="#{structuralEditorBean.paginationInBrackets}"/>
														</div>
														
														<div class="eg3_editInputArea">
															<h:outputText value="#{lbl.edit_paginateEverySecondPage}" />
															<br />
															<h:selectBooleanCheckbox value="#{structuralEditorBean.paginateEverySecondPage}"/>
														</div>
														
														<div class="eg3_editInputArea">
															<h:outputText value="#{lbl.edit_paginationEndPoint}" />
															<br />
															<h:selectOneMenu value="#{structuralEditorBean.selectedPaginationEndPbId}">
																<f:selectItems value="#{structuralEditorBean.paginationEndPbSelectItems}"/>
															</h:selectOneMenu>
														</div>
														<br/>
														<h:commandButton action="#{structuralEditorBean.applyPagination}" value="#{lbl.edit_applyPaginationBtn}" >
															<f:ajax render=":messages :edit :paginator" execute="@form"/>
														</h:commandButton>
													</div>
													</a4j:region>
													
													
													<br/>
													<br/>
													
													<a4j:region>
													<div class="eg3_pageDisplayTypeInputArea">
														<div class="eg3_editInputArea">
															<h:outputText value="#{lbl.edit_pageDisplayType}" />
															<br/>
															<h:selectOneMenu value="#{structuralEditorBean.selectedPb.teiElement.type}">
																<f:selectItem itemValue="#{null}" itemLabel="-"/>
																<f:selectItem itemValue="single" itemLabel="#{lbl.displayType_single}"/>
																<f:selectItem itemValue="left" itemLabel="#{lbl.displayType_recto}"/>
																<f:selectItem itemValue="right" itemLabel="#{lbl.displayType_verso}"/>
															</h:selectOneMenu>
											            </div>
											            
											            <div class="eg3_editInputArea">
												            <h:outputText value="#{lbl.edit_paginationEndPoint}" />
															<br/>
															<h:selectOneMenu value="#{structuralEditorBean.selectedPageDisplayTypeEndPbId}">
																<f:selectItems value="#{structuralEditorBean.paginationEndPbSelectItems}"/>
															</h:selectOneMenu>
														</div>
														<br/>
														<h:commandButton action="#{structuralEditorBean.applyPageDisplayType}" value="#{lbl.edit_applyPaginationDisplayTypeBtn}" >
															<f:ajax render=":messages :edit :paginator" execute="@form"/>
														</h:commandButton>
													</div>
													</a4j:region>
													<br/>
													<br/>
													
													<a4j:region>
													<div class="eg3_pageDisplayTypeInputArea">
														<div class="eg3_editInputArea">
															<h:outputText value="#{lbl.edit_pageType}" />
															<br/>
															<h:selectOneMenu value="#{structuralEditorBean.selectedPb.teiElement.subtype}">
																<f:selectItem itemValue="#{null}" itemLabel="-"/>
																<f:selectItem itemValue="blank" itemLabel="#{lbl.pageType_blank}"/>
																<f:selectItem itemValue="cover" itemLabel="#{lbl.pageType_cover}"/>
																<f:selectItem itemValue="colorchart" itemLabel="#{lbl.pageType_colorchart}"/>
																<f:selectItem itemValue="edge" itemLabel="#{lbl.pageType_edge}"/>
																<f:selectItem itemValue="boardpaper" itemLabel="#{lbl.pageType_boardpaper}"/>
																<f:selectItem itemValue="endsheet" itemLabel="#{lbl.pageType_endsheet}"/>
																<f:selectItem itemValue="spine" itemLabel="#{lbl.pageType_spine}"/>	 
															</h:selectOneMenu>
														</div>
														<div class="eg3_editInputArea">
															<h:outputText value="#{lbl.edit_paginationEndPoint}" />
															<br/>
															<h:selectOneMenu value="#{structuralEditorBean.selectedPageTypeEndPbId}">
																<f:selectItems value="#{structuralEditorBean.paginationEndPbSelectItems}"/>
															</h:selectOneMenu>
														</div>
														<br/>
														<h:commandButton action="#{structuralEditorBean.applyPageType}" value="#{lbl.edit_applyPageTypeBtn}" >
															<f:ajax render=":messages :edit :paginator" execute="@form"/>
														</h:commandButton>
													</div>
													</a4j:region>
										
											</h:panelGroup>
											
											<!-- END PAGE EDITING -->
										</rich:tab>
									</rich:tabPanel>
									</h:form>
									
							
								<!-- END TAB-PANEL -->
								
								<!-- START VALIDATION ERRORS -->
								<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_pageEditingContainer" style="border: 1px solid red;">
									<h:outputText value="#{lbl.edit_validationErrors}"/>
									<br/>
									<ul style="color:red;">
									<a4j:repeat var="validation" value="#{structuralEditorBean.validationList}">
										<li>
										<h:outputText value="#{internationalizationHelper.getLabelForEnum('edit_elementType_', validation.affectedNode.teiElementWrapper.teiElement.elementType)}" />
										<h:outputText value=" cannot be placed under " />
										<h:outputText value="#{internationalizationHelper.getLabelForEnum('edit_elementType_', validation.affectedNode.parent.teiElementWrapper.teiElement.elementType)}" />
										</li>
									</a4j:repeat>
									</ul>
						        </h:panelGroup>
						        <!-- END VALIDATION ERRORS -->
								
								
								<!-- START TREE -->
								<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_editorStructureTree" id="tree">
									<h:form id="structuralEditorForm">
										<rich:tree toggleType="ajax" var="divItem" >
											<rich:treeModelRecursiveAdaptor roots="#{structuralEditorBean.treeWrapperNodes}" nodes="#{divItem.children}">
												
												<rich:treeNode styleClass="struct_#{divItem.teiElementWrapper.pagebreakWrapper.teiElement.id}" expanded="#{true}" rendered="#{divItem.teiElementWrapper.teiElement.elementType != 'PB'}" >
													
													
												
													<h:panelGroup style="#{divItem.teiElementWrapper.pagebreakWrapper == structuralEditorBean.selectedPb ? 'font-size:130%;' : ''}">
														
														<mpdl:treeEntry teiElement="#{divItem.teiElementWrapper.teiElement}" linkAction="#{structuralEditorBean.selectStructuralElement(divItem.teiElementWrapper)}" linkStyle="#{divItem.invalid ? 'color:red;' : ''}"
																render=":messages :edit :paginator"/>							
	
														<h:outputText value=" (#{divItem.teiElementWrapper.pagebreakWrapper.page.order + 1}"/>
														<h:outputText value=" / #{divItem.teiElementWrapper.pagebreakWrapper.teiElement.numeration}" rendered="#{not empty divItem.teiElementWrapper.pagebreakWrapper.teiElement.numeration}"/>
														<h:outputText value=" - "/>
														
														<h:panelGroup rendered="#{divItem.teiElementWrapper.pagebreakWrapper != structuralEditorBean.selectedPb or divItem.teiElementWrapper.teiElement.elementType=='FRONT' or divItem.teiElementWrapper.teiElement.elementType=='BODY' or divItem.teiElementWrapper.teiElement.elementType=='BACK'}">
															<h:outputText value="#{divItem.teiElementWrapper.partnerElement.pagebreakWrapper.page.order + 1}" />
															<h:outputText value=" / #{divItem.teiElementWrapper.partnerElement.pagebreakWrapper.teiElement.numeration}" rendered="#{not empty divItem.teiElementWrapper.partnerElement.pagebreakWrapper.teiElement.numeration}"/>
														</h:panelGroup>
														
														
														
														<h:selectOneMenu value="#{divItem.teiElementWrapper.partnerElement.pagebreakIdToMoveTo}" rendered= "#{divItem.teiElementWrapper.pagebreakWrapper == structuralEditorBean.selectedPb and divItem.teiElementWrapper.teiElement.elementType!='FRONT' and divItem.teiElementWrapper.teiElement.elementType!='BODY' and divItem.teiElementWrapper.teiElement.elementType!='BACK'}">
															<f:selectItems value="#{structuralEditorBean.getEndPagesSelectItemsForElement(divItem.teiElementWrapper)}"/>
															<f:ajax event="change" listener="#{structuralEditorBean.moveEndPageTo(divItem.teiElementWrapper, divItem.teiElementWrapper.partnerElement.pagebreakIdToMoveTo)}" render=":messages :edit :paginator"/>
														</h:selectOneMenu>
														
														<h:outputText value=")"/>
													
													</h:panelGroup>
													
													<h:commandButton value="&lt;&lt;" action="#{structuralEditorBean.moveElementToLeft(divItem.teiElementWrapper)}" rendered="#{divItem.teiElementWrapper.pagebreakWrapper == structuralEditorBean.selectedPb and divItem.movableToLeft}">
														<f:ajax render=":messages :edit :paginator" execute="@form"/>
													</h:commandButton>
													
													<h:commandButton value="&gt;&gt;" action="#{structuralEditorBean.moveElementToRight(divItem.teiElementWrapper)}" rendered="#{divItem.teiElementWrapper.pagebreakWrapper == structuralEditorBean.selectedPb and divItem.movableToRight}">
														<f:ajax render=":messages :edit :paginator" execute="@form"/>
													</h:commandButton>
													
													<h:commandButton value="Up" action="#{structuralEditorBean.moveElementUp(divItem.teiElementWrapper)}" rendered="#{divItem.teiElementWrapper.pagebreakWrapper == structuralEditorBean.selectedPb and divItem.movableUp}">
														<f:ajax render=":messages :edit :paginator" execute="@form"/>
													</h:commandButton>
													
													<h:commandButton value="Down" action="#{structuralEditorBean.moveElementDown(divItem.teiElementWrapper)}" rendered="#{divItem.teiElementWrapper.pagebreakWrapper == structuralEditorBean.selectedPb and divItem.movableDown}">
														<f:ajax render=":messages :edit :paginator" execute="@form"/>
													</h:commandButton>
												
													<h:commandButton action="#{structuralEditorBean.deleteStructuralElement(divItem.teiElementWrapper)}" value="#{lbl.edit_deleteStructuralElementBtn}" rendered="#{divItem.teiElementWrapper.pagebreakWrapper == structuralEditorBean.selectedPb and divItem.teiElementWrapper.teiElement.elementType!='FRONT' and divItem.teiElementWrapper.teiElement.elementType!='BODY' and divItem.teiElementWrapper.teiElement.elementType!='BACK'}">
														<f:ajax render=":messages :edit :paginator" execute="@form"/>
													</h:commandButton>
													
													<ui:remove>
													<h:commandButton action="#{structuralEditorBean.editStructuralElement(divItem.teiElementWrapper)}"  value="#{lbl.edit_editStructuralElementBtn}" rendered="#{divItem.teiElementWrapper.pagebreakWrapper == structuralEditorBean.selectedPb and divItem.teiElementWrapper.teiElement.elementType!='FRONT' and divItem.teiElementWrapper.teiElement.elementType!='BODY' and divItem.teiElementWrapper.teiElement.elementType!='BACK'}" >
														<f:ajax render=":messages :edit :paginator" execute="@form"/>
													</h:commandButton>
													</ui:remove>
													<a4j:commandButton render="editPopup" action="#{structuralEditorBean.editStructuralElement(divItem.teiElementWrapper)}"  oncomplete="#{rich:component('editPopup')}.show()" value="#{lbl.edit_editStructuralElementBtn}" rendered="#{divItem.teiElementWrapper.pagebreakWrapper == structuralEditorBean.selectedPb and divItem.teiElementWrapper.teiElement.elementType!='FRONT' and divItem.teiElementWrapper.teiElement.elementType!='BODY' and divItem.teiElementWrapper.teiElement.elementType!='BACK'}" />
													
												</rich:treeNode>
												
											</rich:treeModelRecursiveAdaptor>
										</rich:tree>
									</h:form>
									
								</h:panelGroup>
								<!-- END TREE -->
								

								<script type="text/javascript">
									var structTree = $('.eg3_editorStructureTree');
									function resizeTreeContainer() {
										structTree.css("height", ($('.eg3_editPage_imgContainer').height() - Math.round(structTree.position().top)));
										//console.log("inside");
									}
									resizeTreeContainer();
									$('.rf-tab-hdr').change(function(){
										resizeTreeContainer();
									});
								</script>
								
								
								
								
								
								
								
								
								
								
								
								
						
								<!-- START EDIT STRUCTURE POPUP -->
							<rich:popupPanel id="editPopup" modal="true" resizeable="false" domElementAttachment="form" width="600" height="400" >
								<f:facet name="header">
									<h:outputText value="#{lbl.edit_structureHeader}" />
								</f:facet>
								<f:facet name="controls">
									<h:outputLink value="#" onclick="#{rich:component('editPopup')}.hide(); return false;">X</h:outputLink>	
								</f:facet>
								<h:form>
								
								<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_pageEditingContainer eg3_editContent">
									<h3><h:outputText value="#{lbl.edit_structureHeader}" /></h3>
									
									
									
									<structTypes:structuralTypeEditor selectedStructuralType="#{structuralEditorBean.selectedStructuralEditType}" 
										structuralTypeChangeListener="#{structuralEditorBean.selectedStructuralEditElementTypeChanged}"
										teiWrapper="#{structuralEditorBean.currentEditElementWrapper}"/>
									<br/>
									<br/>
									<h:commandButton type="submit" styleClass="eg3_floatRight" value="#{lbl.edit_updateStructuralElementBtn}" action="#{structuralEditorBean.updateEditedStructuralElement}">
										<f:ajax render=":messages :edit :paginator" execute="@form" onevent="function(evt){#{rich:component('editPopup')}.hide(); return false;}"/>
									</h:commandButton>
									<h:outputLink value="#" onclick="#{rich:component('editPopup')}.hide(); return false;">
									<h:outputText value="#{lbl.edit_cancelBtn}"/>
									</h:outputLink>									
								</h:panelGroup>

								</h:form>
							</rich:popupPanel>
							<!-- END EDIT STRUCTURE POPUP -->
						
								
							</h:panelGroup>

					</h:panelGroup>	
				</h:panelGroup>
			</h:panelGroup>
		</ui:define>
	</ui:composition>
</html>
