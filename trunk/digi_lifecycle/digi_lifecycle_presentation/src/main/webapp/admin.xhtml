<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:mpdl="http://java.sun.com/jsf/composite/components/mpdl"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:pretty="http://ocpsoft.com/prettyfaces">

	<ui:composition template="templates/template_v3.xhtml">
	
		<ui:define name="mainContent">
			<style type="text/css">
				.eg3_adminPage .eg3_submitPanel {
					margin-top:2em;
				}
				.eg3_adminPage .eg3_submitPanel input[type=submit] {
					background-color:transparent;
					margin-left:1em;
					border-bottom:0.0833333em solid #2F2F2F;
				}
				.eg3_adminPage .eg3_submitPanel input[type=submit]:hover {
					text-decoration:none;
					border-bottom:0.0833333em solid #EA7125;
				}
			</style>
			<h:form>
				<h:panelGroup layout="block" styleClass="eg3_container_9_10 eg3_containerCenter eg3_adminPage">
					
					<rich:tabPanel switchType="ajax">
						<rich:tab label="createdOUs" id="createdOUs" header="#{lbl.admin_ou_header}:" rendered="#{loginBean.login and loginBean.user.grants[0].properties.role.objid == 'escidoc:role-system-administrator'}">
							<a4j:repeat value="#{loginBean.user.createdOrgas}" var="orga">
								<h:panelGroup layout="block" styleClass="eg3_clearBoth eg3_container_1">
									<pretty:link mappingId="ou">
										<f:param value="#{orga.id}"/>
										<h:outputText value="#{orga.escidocMd.title}"/>
										
										<h:panelGroup styleClass="eg3_floatRight">
											<a4j:commandButton title="#{lbl.button_command_delete}" value=" " styleClass="eg3_icon_delete_16_16" execute="@this" render="@none" oncomplete="#{rich:component('confirmOrgaPane')}.show()">
												<f:setPropertyActionListener target="#{adminBean.orga}" value="#{orga}"/>
											</a4j:commandButton>
											<a4j:commandButton title="#{lbl.button_command_edit}" value=" " styleClass="eg3_icon_editBtni_16_16" execute="@this" render="editOrga" oncomplete="#{rich:component('popup')}.show()">
												<a4j:param value="#{orga.id}" assignTo="#{adminBean.editOrgaId}"/>
												<f:setPropertyActionListener target="#{adminBean.orga}" value="#{orga}"/>
											</a4j:commandButton>
										</h:panelGroup>
									</pretty:link>
								</h:panelGroup>
							</a4j:repeat>
							
							<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_submitPanel">
								<a4j:commandButton execute="@this" value="#{lbl.admin_ou_createNew}" styleClass="eg3_borderradius_5" render="editOrga" oncomplete="#{rich:component('popup')}.show()">
									<f:setPropertyActionListener target="#{adminBean.orga}" value="#{adminBean.newEmptyOrga}"/>
								</a4j:commandButton>
							</h:panelGroup>
							
							
							<rich:popupPanel id="confirmOrgaPane" autosized="true">
								<h:outputText value="#{msg.admin_confirmCloseOu}"/>
								<a4j:commandButton value="#{lbl.button_command_cancel}" onclick="#{rich:component('confirmOrgaPane')}.hide(); return false;"/>
								<a4j:commandButton value="#{lbl.button_command_delete}" execute="@this" action="#{adminBean.closeOrganization}"/>
							</rich:popupPanel>
							
							<mpdl:ouEditor target="popup" organization="#{adminBean.orga}" command="#{adminBean.editOrga}"/>
						</rich:tab>
						
						<rich:tab label="createdContexts" id="createdContexts" header="#{lbl.admin_context_header}:" rendered="#{loginBean.login and loginBean.user.grants[0].properties.role.objid == 'escidoc:role-ou-administrator'}" >
							<a4j:repeat value="#{loginBean.user.createdCollections}" var="collection">
								<h:panelGroup layout="block" styleClass="eg3_clearBoth eg3_container_1">
									<pretty:link mappingId="volumes">
										<f:param value="#{collection.id}"/>
										<h:outputText value="#{collection.name}"/>
										
										<h:panelGroup styleClass="eg3_floatRight">
											<a4j:commandButton title="#{lbl.button_command_delete}" value=" " styleClass="eg3_icon_delete_16_16" execute="@this" render="@none" oncomplete="#{rich:component('confirmCollectionPane')}.show()">
												<f:setPropertyActionListener target="#{adminBean.collection}" value="#{collection}"/>
											</a4j:commandButton>
											<a4j:commandButton title="#{lbl.button_command_edit}" value=" " styleClass="eg3_icon_editBtni_16_16" execute="@this" render="editCollection" oncomplete="#{rich:component('popupContext')}.show()">
												<a4j:param value="#{collection.id}" assignTo="#{adminBean.editCollectionId}"/>
												<f:setPropertyActionListener target="#{adminBean.collection}" value="#{collection}"/>
											</a4j:commandButton>
										</h:panelGroup>
									</pretty:link>
								</h:panelGroup>
							</a4j:repeat>
							
							<rich:popupPanel id="confirmCollectionPane" autosized="true"> 
				    			<h:outputText value="#{msg.admin_confirmCloseCollection}"/>
				    			<a4j:commandButton value="#{lbl.button_command_cancel}" onclick="#{rich:component('confirmUserPane')}.hide(); return false;"/>
				    			<a4j:commandButton value="#{lbl.button_command_delete}" action="#{adminBean.closeCollection}"/>
				    		</rich:popupPanel>
				    		
				    		<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_submitPanel">
					    		<a4j:commandButton execute="@this" value="#{lbl.admin_context_createNew}" styleClass="eg3_borderradius_5" render="editCollection" oncomplete="#{rich:component('popupContext')}.show()">
					    			<f:setPropertyActionListener target="#{adminBean.collection}" value="#{adminBean.newEmptyCollection}"/>
					    		</a4j:commandButton>
				    		</h:panelGroup>
				    		
				    		<mpdl:contextEditor target="popupContext" title="#{lbl.admin_context_createNew}" collection="#{adminBean.collection}"/>
						</rich:tab>
						
						<rich:tab label="createdUAs" id="createdUAs" header="#{lbl.admin_user_header}:" rendered="#{loginBean.login}">
							<a4j:repeat value="#{loginBean.user.createdUsers}" var="user">
								<h:panelGroup layout="block" styleClass="eg3_clearBoth eg3_container_1">
									<h:outputText value=" #{lbl.admin_user_loginname}: #{user.loginName} "/>
									<h:outputText value=" (#{lbl.admin_user_name}: #{user.name}) "/>
									
									<h:panelGroup styleClass="eg3_floatRight">
										<a4j:commandButton title="#{lbl.button_command_delete}" value=" " styleClass="eg3_icon_delete_16_16" execute="@this" render="@none" oncomplete="#{rich:component('confirmUserPane')}.show()">
											<f:setPropertyActionListener target="#{adminBean.user}" value="#{user}"/>
										</a4j:commandButton>
										<a4j:commandButton title="#{lbl.button_command_edit}" value=" " styleClass="eg3_icon_editBtni_16_16" execute="@this" render="editUser" oncomplete="#{rich:component('popupUser')}.show()">
											<a4j:param value="#{user.id}" assignTo="#{adminBean.editUserId}"/>
											<f:setPropertyActionListener target="#{adminBean.user}" value="#{user}"/>
										</a4j:commandButton>
									</h:panelGroup>
				               	</h:panelGroup> 
							</a4j:repeat>
							
							<rich:popupPanel id="confirmUserPane" autosized="true">
								<h:outputText value="#{msg.admin_confirmCloseUser}"/>
								<a4j:commandButton title="#{lbl.button_command_cancel}" value=" " styleClass="" onclick="#{rich:component('confirmUserPane')}.hide(); return false;"/>
								<a4j:commandButton title="#{lbl.button_command_delete}" value=" " styleClass="eg3_icon_delete_16_16" execute="@this" action="#{adminBean.deleteUser}" rendered="#{loginBean.login and loginBean.user.grants[0].properties.role.objid == 'escidoc:role-system-administrator'}"/>
								<a4j:commandButton title="#{lbl.button_command_delete}" value=" " styleClass="eg3_icon_delete_16_16" execute="@this" action="#{adminBean.deleteUser}" rendered="#{loginBean.login and loginBean.user.grants[0].properties.role.objid == 'escidoc:role-ou-administrator'}"/>
							</rich:popupPanel>
							
							<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_submitPanel">
								<a4j:commandButton execute="@this" value="#{lbl.admin_user_createNew}" styleClass="eg3_borderradius_5" render="editUser" oncomplete="#{rich:component('popupUser')}.show()">
									<f:setPropertyActionListener target="#{adminBean.user}" value="#{adminBean.newEmptyUser}"/>
								</a4j:commandButton>
							</h:panelGroup>
							
							<mpdl:userEditor target="popupUser" title="#{lbl.admin_user_createNew}" user="#{adminBean.user}"/>
						</rich:tab>
					</rich:tabPanel>
					
				</h:panelGroup>
			</h:form>
		</ui:define>
	</ui:composition>
</html>
