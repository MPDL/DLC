<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:mpdl="http://java.sun.com/jsf/composite/components/mpdl"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:pretty="http://ocpsoft.com/prettyfaces">

<ui:composition template="templates/template.xhtml">

	<h:outputStylesheet>

        .rf-p  {
            width: 500px;
        }
 


    </h:outputStylesheet>

	<ui:define name="mainContent">

		<rich:panel layout="block" id="createdOUs" header="Created Organizations:" rendered="#{loginBean.login and loginBean.user.grants[0].properties.role.objid == 'escidoc:role-system-administrator'}">
			<a4j:repeat value="#{loginBean.user.createdOrgas}" var="orga">
				<pretty:link mappingId="ou">
					<f:param value="#{orga.id}" />
			    	<h:outputText value="#{orga.escidocMd.title}"/>
			    	
			    	<a4j:commandButton value="Delete" execute="@this" render="@none" oncomplete="#{rich:component('confirmPane')}.show()">
                    	<!-- <h:graphicImage value="/resources/images/Delete.png" alt="delete" /> -->
                   		<f:setPropertyActionListener target="#{adminBean.orga}" value="#{orga}" />
               		</a4j:commandButton> 
               		
               		<a4j:commandButton value="Edit" execute="@this" render="editOrga" oncomplete="#{rich:component('popup')}.show()">
                    	<a4j:param value="#{orga.id}" assignTo="#{adminBean.editOrgaId}" />
                   		<f:setPropertyActionListener target="#{adminBean.orga}" value="#{orga}" />
               		</a4j:commandButton> 
			    </pretty:link>
			   <br />
	      	</a4j:repeat>

            <a4j:commandButton execute="@this" value="Create New Organization" render="editOrga" oncomplete="#{rich:component('popup')}.show()">
            	<a4j:param value="#{orga.id}" assignTo="#{adminBean.editOrgaId}" />
              	<f:setPropertyActionListener target="#{adminBean.orga}" value="#{adminBean.newEmptyOrga}" />
            </a4j:commandButton> 

    		<rich:popupPanel id="confirmPane" autosized="true"> 
    			 Are you sure you want to close this organization?
        		<a4j:commandButton value="Cancel" onclick="#{rich:component('confirmPane')}.hide(); return false;" />
        		<a4j:commandButton value="Delete" action="#{adminBean.closeOrganization}"/>
    		</rich:popupPanel>
		    
   			<mpdl:ouEditor target="popup" organization="#{adminBean.orga}" command="#{adminBean.editOrga}"/>

		</rich:panel>
		
		<rich:panel layout="block" id="createdContexts" header="Created Collections:" rendered="#{loginBean.login and loginBean.user.grants[0].properties.role.objid == 'escidoc:role-ou-administrator'}" >
			<a4j:repeat value="#{loginBean.user.createdCollections}" var="collection">
				<pretty:link mappingId="volumes">
					<f:param value="#{collection.id}" />
			    	<h:outputText value="#{collection.name}"/>
			    	<h:commandButton value="Close" action="#{adminBean.closeCollection(collection)}" />
			    	<h:commandButton value="Edit"  />
			    </pretty:link>
			   <br />
	      	</a4j:repeat>
		 	
		 	
		    <rich:toolbar height="26px" width="100px">
		        <h:outputLink value="#" id="newContext">
		            <rich:componentControl event="click" operation="show" target="popupContext">
		                <a4j:param name="event" value="event" noEscape="true" />
		                <rich:hashParam>
		                    <a4j:param noEscape="true" name="top"
		                        value="jQuery(#{rich:element('newContext')}.parentNode).offset().top + jQuery(#{rich:element('newContext')}.parentNode).height()" />
		                    <a4j:param noEscape="true" name="left"
		                        value="jQuery(#{rich:element('newContext')}.parentNode).offset().left" />
		                </rich:hashParam>
		            </rich:componentControl>
		            Create new Collection:</h:outputLink>
		    </rich:toolbar>

   			<mpdl:contextEditor target="popupContext" title="Create new" collection="#{adminBean.collection}" />

		</rich:panel>

		<rich:panel layout="block" id="createdUAs" header="All Users:" rendered="#{loginBean.login}">
			<a4j:repeat value="#{loginBean.user.createdUsers}" var="user">
			    <h:outputText value=" loginname: #{user.loginName} "/>
			    <h:outputText value=" (name: #{user.name}) "/>
			    <h:commandButton value="Delete" action="#{adminBean.deleteUser(user)}" rendered="#{loginBean.user.grants[0].properties.role.objid == 'escidoc:role-system-administrator'}"/>
			    <h:commandButton value="Edit"  />
			    
			   <br />
	      	</a4j:repeat>
		 
		    <rich:toolbar height="26px" width="100px">
		        <h:outputLink value="#" id="newUA">
		            <rich:componentControl event="click" operation="show" target="popupUser">
		                <a4j:param name="event" value="event" noEscape="true" />
		                <rich:hashParam>
		                    <a4j:param noEscape="true" name="top"
		                        value="jQuery(#{rich:element('newUA')}.parentNode).offset().top + jQuery(#{rich:element('newUA')}.parentNode).height()" />
		                    <a4j:param noEscape="true" name="left"
		                        value="jQuery(#{rich:element('newUA')}.parentNode).offset().left" />
		                </rich:hashParam>
		            </rich:componentControl>
		            Create new User:</h:outputLink>
		    </rich:toolbar>

   			<mpdl:userEditor target="popupUser" title="Create new" user="#{adminBean.user}" />

		</rich:panel>



	</ui:define>


</ui:composition>

</html>
