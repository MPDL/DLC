<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:fu="http://java.sun.com/jsf/composite/components/fileUpload"
	xmlns:mpdl="http://java.sun.com/jsf/composite/components/mpdl"
	xmlns:load="http://java.sun.com/jsf/composite/components/lazyLoad"
	xmlns:pretty="http://ocpsoft.com/prettyfaces"
	xmlns:modsViewer="http://java.sun.com/jsf/composite/components/mpdl/modsViewer">

	<ui:composition template="templates/template_v3.xhtml">
		
		<ui:define name="separateContentHeader">
			<h:panelGroup layout="block" styleClass="eg3_viewPageHeader eg3_container_3_5">
				<h:panelGroup layout="block" styleClass="eg3_container_1">
					<h:panelGroup layout="block" styleClass="eg3_detailItemHeader">
						<h3 class="eg3_multiVolumeTitle">
							<h:outputText value="#{viewPages.context.properties.name}"/> 
						</h3>
						
						<br />
						<ui:remove>
						<h:panelGroup styleClass="eg3_icon_multiVolume_32_32">&#160;</h:panelGroup>
						</ui:remove>
						<h:panelGroup styleClass="eg3_floatLeft">
							<h3 class="eg3_volumeTitle"><h:outputText value="#{volumeUtilBean.getTitle(viewPages.volume.modsMetadata).title}"/></h3>
							<h4 class="eg3_volumeDetails"><h:outputText value="#{volumeUtilBean.getFirstEditor(viewPages.volume.modsMetadata).name}"/></h4>
						</h:panelGroup>
					</h:panelGroup>
				</h:panelGroup>
			</h:panelGroup>
		</ui:define>
		
		<ui:define name="citationLinkContent">
			<h:panelGroup layout="block" styleClass="eg3_container_1_5 eg3_floatRight eg3_citationLinkArea">
				<input type="button" class="eg3_floatRight" value="#{lbl.view_citationLink}" onclick="$('.eg3_citationLink').toggle();" style="margin-left:2%; background-color:transparent;"/>
				<br />
				<h:inputText id="citationLink" value="#{applicationBean.domain}/#{applicationBean.contextPath}/view/#{viewPages.volumeId}/#{viewPages.viewTypeText}/#{viewPages.selectedPageNumber}" readonly="true" styleClass="eg3_citationLink eg3_floatRight"/>
			</h:panelGroup>
		</ui:define>
		<ui:remove>
		<ui:define name="breadcrumpTitle">			
			<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_breadTitle" style="background-color:#323232;">
				<mpdl:hierarchicalBreadcrumb ou="#{hierarchicalBreadcrumbHelper.getVolumeCollection(viewPages.volume)}" colId="#{viewPages.volume.item.properties.context.objid}" colName="#{viewPages.volume.item.properties.context.getXLinkTitle()}" volumes="true">
				</mpdl:hierarchicalBreadcrumb>
			</h:panelGroup>	
		</ui:define>
		</ui:remove>
		<ui:define name="mainContent">
			<h:panelGroup styleClass="eg3_hidden">
				<ui:repeat value="#{viewPages.pageList}" var="page">
				<h:graphicImage id="img" value="#{volumeUtilBean.getImageServerUrl(page.contentIds, 'THUMBNAIL')}" style="width:60px;" />
				</ui:repeat>
			</h:panelGroup>
			<h:panelGroup id="viewPageContainer" layout="block" styleClass="eg3_container_1 eg3_viewPageContainer" style="background-color:#323232;">
				<!-- SIDEBAR LEFT -->
				<h:panelGroup layout="block" styleClass="eg3_id_sidebarLeft eg3_container_1_4">
					<h:form styleClass="eg3_overflow" style="z-index:50;">
						
						<rich:tabPanel id="tabPanel" switchType="ajax" activeItem="#{loginBean.tab}" itemChangeListener="#{loginBean.changeTab}">
							
							<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_content_bgColor eg3_iconBar eg3_textRight">
								<input type="button" class="eg3_expandOverlay eg3_modusBtn eg3_borderradius_5" style="width:1.333333em;" onclick="eg3_openOverlay(this);" value="+"/>
								<input type="button" class="eg3_collapseOverlay eg3_modusBtn eg3_borderradius_5" style="width:1.333333em;" onclick="eg3_closeOverlay(this);" disabled="disabled" value="-"/>
								<input type="button" class="eg3_modusBtn eg3_borderradius_5" value="print"/>
							</h:panelGroup>
							<script type="text/javascript">
									jsf.ajax.addOnEvent(function(e)
									{	
										//notice the container height for setting a min-height while ajax reloading
										//without a height value the page jump to top because of to slowly image loading
										if (e.status == "begin") {
											$('.eg3_viewPageContainer').css("min-height", $('.eg3_viewPageContainer').height());
											eg3_closeOverlay('.eg3_collapseOverlay');
										}
										//if the ajax request is success
										//scroll to the right position in sidebar and delete the min-height value of the global parent container for dynamical browser behaviour
										if(e.status=="success")
										{
											scrollDivs();
										}
									});
									
									function scrollDivs()
									{
										var selectedDivId= '#{viewPages.selectedDiv.id}';
										var treeContainerId = "#{rich:clientId('toc')}";
										//add an backslahs before all colons					
										treeContainerId = treeContainerId.replace(/:/g, "\\:");
										var treeContainerDiv = $('#' + treeContainerId);
										
										
										//var selectedPb = 'page_300';
										var pos = $('.struct_' + selectedDivId).offset();
										if(pos!=null)
										{
											var treeContainerPos = $(treeContainerDiv).offset();				
											var currentScroll = $(treeContainerDiv).scrollTop();				
											var newScrollPos = pos.top - treeContainerPos.top + currentScroll - 50;				
											treeContainerDiv.scrollTop(newScrollPos);
											resetViewPageContainer();
											checkSidebarHeight('.eg3_viewPage');
										}
									}
									
									function resetViewPageContainer() 
									{
										var reloadDone = false;
										
										$('.eg3_viewPageContainer .eg3_viewPage_imgContainer').each(function(i) 
										{
											if ($(this).height() > 0) 
											{
												reloadDone = true;
											}
										});
										(reloadDone) ? removeAttributeValue('.eg3_viewPageContainer', "style", "min-height") : setTimeout("resetViewPageContainer()", 25);
									}
									
									$(document).ready(function(e)
									{
										scrollDivs();
										
										$(window).resize(function(e)
										{
											resizeSidebar('.eg3_viewPage');
										});
										
										checkSidebarHeight('.eg3_viewPage');
									});
								</script>
			     			
			     			<rich:tab header="#{lbl.view_tab_structure}" id="toc">
								<rich:tree toggleType="ajax" var="divItem" >
									<rich:treeModelRecursiveAdaptor roots="#{viewPages.volume.teiSd.pbOrDiv}" nodes="#{divItem.pbOrDiv}">
										<rich:treeNode expanded="#{true}" rendered="#{divItem.elementType != 'PB'}">
											<h:commandLink action="#{viewPages.goTo(divItem)}" styleClass="struct_#{divItem.id}" style="#{divItem == viewPages.selectedDiv ? 'background-color:red;' : ''}">
												<h:panelGroup rendered="#{divItem.elementType=='DIV' or divItem.elementType=='TITLE_PAGE'}">
													<h:outputText value="[#{divItem.type}] " rendered="#{not empty divItem.type}"/>
													<h:outputText value="[Section] " rendered="#{empty divItem.type}"/>
													<h:outputText value="#{divItem.numeration} " rendered="#{not empty divItem.numeration}"/>
													<h:outputText value="#{divItem.author1inv}" rendered="#{not empty divItem.author1inv}"/>
													<h:outputText value="; #{divItem.author2inv}" rendered="#{not empty divItem.author2inv}"/>
													<h:outputText value="; #{divItem.author3inv}" rendered="#{not empty divItem.author3inv}"/>
													<h:outputText value=" : " rendered="#{(not empty divItem.author1inv or not empty divItem.author2inv or not empty divItem.author3inv) and not empty divItem.head}"/>
												</h:panelGroup>
												
												<h:panelGroup rendered="#{divItem.elementType=='FRONT' or divItem.elementType=='BODY' or divItem.elementType=='BACK'}">
													<h:outputText value="#{divItem.elementType}"/>
												</h:panelGroup>
												
												<h:panelGroup rendered="#{divItem.elementType=='FIGURE'}">
													<h:outputText value="[#{divItem.elementType}]"/>
												</h:panelGroup>
												
												<f:ajax render=":viewPage :#{rich:clientId('tabPanel')}"/>
											</h:commandLink>
											
											<h:outputText value="#{volumeUtilBean.replaceLineBreaksWithBlanks(divItem.head)}" rendered="#{not empty divItem.head}"/>
											<h:outputText value="#{volumeUtilBean.replaceLineBreaksWithBlanks(divItem.docTitles[0].title)}" rendered="#{divItem.elementType == 'TITLE_PAGE'}"/>
										</rich:treeNode>
									</rich:treeModelRecursiveAdaptor>
								</rich:tree>
							</rich:tab>
							
							<rich:tab header="#{lbl.view_tab_thumbnails}" id="thumbs">
								<load:lazyLoad pageList="#{viewPages.pageList}">
									<h:commandLink action="#{viewPages.goToPage(var)}">
										<h:graphicImage id="img" value="#{volumeUtilBean.getImageServerUrl(var.contentIds, 'THUMBNAIL')}" style="width:60px;" />
										<f:ajax render="@all"/>
									</h:commandLink>
								</load:lazyLoad>
							</rich:tab>
							
							<rich:tab header="#{lbl.view_tab_biblMd}" id="bibmd" style="width:40em" onmouseover="$('span.double_area0').width('40em'); $('span.double_area0').css('opacity','0.8')" onmouseout="$('span.double_area0').width('18.83em');$('span.double_area0').css('opacity','1');">
								<h:commandButton value="#{lbl.button_command_isbd}">
									<rich:componentControl target="isbdPopup" operation="show" />
								</h:commandButton>
								<h:panelGroup>
									<modsViewer:default modsMetadata="#{viewPages.volume.modsMetadata}" />
									<!--<h:outputText value="#{viewPages.volume.item.properties.contentModel.objid}" />  -->
								</h:panelGroup>
							    <rich:popupPanel id="isbdPopup" modal="false" autosized="true" >
							        <f:facet name="controls">
							            <h:outputLink value="#" onclick="#{rich:component('isbdPopup')}.hide(); return false;">  X </h:outputLink>
							        </f:facet>
							        <h:panelGroup rendered="#{viewPages.volume.item.properties.contentModel.objid == 'escidoc:2001'}">
										<modsViewer:isbd modsMetadata="#{viewPages.volume.modsMetadata}" />
									</h:panelGroup>
									<h:panelGroup rendered="#{viewPages.volume.item.properties.contentModel.objid == 'escidoc:2003'}">
										<modsViewer:isbd_vol modsMetadata="#{viewPages.volume.modsMetadata}" />
									</h:panelGroup>
							    </rich:popupPanel>							
							</rich:tab>
							
							<rich:tab header="#{lbl.view_tab_description}" id="desc">
								
							</rich:tab>
						</rich:tabPanel>
					</h:form>
				</h:panelGroup>
				
				<h:panelGroup id="viewPage" layout="block" styleClass="eg3_container_3_4 eg3_viewPage">
					<!-- viewPageMenu -->
					<h:panelGroup layout="block" styleClass="eg3_viewPageMenu eg3_textCenter" style="overflow:visible;">
						<h:panelGroup layout="block" styleClass="eg3_viewModusContainer" rendered="#{viewPages.selectedPage != null or viewPages.selectedRightPage != null}">
							<ui:fragment rendered="#{viewPages.selectedPage != null}">
								<h:form>
									<h:commandLink action="#{viewPages.switchViewType('SINGLE', viewPages.selectedPage)}" styleClass="eg3_modusBtn eg3_firstBtn" disabled="#{viewPages.viewType == 'SINGLE'}" title="#{tlt.view_page_single}">
										<h:outputText value="#{lbl.view_singlePage}"/>
									</h:commandLink>
									
									<h:commandLink action="#{viewPages.switchViewType('RECTO_VERSO', viewPages.selectedPage)}" styleClass="eg3_modusBtn" disabled="#{viewPages.viewType == 'RECTO_VERSO'}" title="#{tlt.view_page_rectoVerso}">
										<h:outputText value="#{lbl.view_rectoVersoPage}"/>
									</h:commandLink>
									
									<h:commandLink action="#{viewPages.switchViewType('FULLTEXT', viewPages.selectedPage)}" styleClass="eg3_modusBtn" disabled="#{viewPages.viewType == 'FULLTEXT'}" title="#{tlt.view_page_transcript}">
										<h:outputText value="#{lbl.view_fulltextPage}"/>
									</h:commandLink>
									
									<h:commandLink action="#{viewPages.switchViewType('FULLTEXT', viewPages.selectedPage)}" styleClass="eg3_modusBtn" disabled="true" title="">
										<h:outputText value="#{lbl.view_xmlPage}"/>
									</h:commandLink>
								</h:form>
							</ui:fragment>
							<ui:fragment rendered="#{viewPages.selectedPage == null}">
								<h:form>
									<h:commandLink action="#{viewPages.switchViewType('SINGLE', viewPages.selectedRightPage)}" styleClass="eg3_modusBtn eg3_firstBtn" disabled="#{viewPages.viewType == 'SINGLE'}" title="#{tlt.view_page_single}">
										<h:outputText value="#{lbl.view_singlePage}"/>
									</h:commandLink>
									
									<h:commandLink action="#{viewPages.switchViewType('RECTO_VERSO', viewPages.selectedRightPage)}" styleClass="eg3_modusBtn" disabled="#{viewPages.viewType == 'RECTO_VERSO'}" title="#{tlt.view_page_rectoVerso}">
										<h:outputText value="#{lbl.view_rectoVersoPage}"/>
									</h:commandLink>
									
									<h:commandLink action="#{viewPages.switchViewType('FULLTEXT', viewPages.selectedRightPage)}" styleClass="eg3_modusBtn" disabled="#{viewPages.viewType == 'FULLTEXT'}" title="#{tlt.view_page_transcript}">
										<h:outputText value="#{lbl.view_fulltextPage}"/>
									</h:commandLink>
									
									<h:commandLink action="#{viewPages.switchViewType('FULLTEXT', viewPages.selectedRightPage)}" styleClass="eg3_modusBtn" disabled="true" title="">
										<h:outputText value="#{lbl.view_xmlPage}"/>
									</h:commandLink>
								</h:form>
							</ui:fragment>
							
							<ui:remove>
								<h:outputText value="&#160;" rendered="#{empty viewPages.selectedPage}"/>
							</ui:remove>
							
							<h:outputText value="&#160;" rendered="#{!viewPages.selectedPage.orderLabel}"/>
						</h:panelGroup>
						
						<h:panelGroup id="pageBrowser" styleClass="eg3_textCenter">
							<h:form styleClass="eg3_pageBrowser">
								<ui:fragment rendered="#{viewPages.selectedPageNumber > 1}">
									<h:commandLink action="#{viewPages.goToFirstPage}" title="#{tlt.paginator_goToFirstPage}">
										<h:panelGroup styleClass="eg3_icon_skipTofirst_16_16">&#160;</h:panelGroup>
										<f:ajax render=":viewPage :#{rich:clientId('tabPanel')} :citationLink"/>
									</h:commandLink>
									<h:commandLink action="#{viewPages.goToPreviousPage}" title="#{tlt.paginator_goToPreviousPage}">
										<h:panelGroup styleClass="eg3_icon_backward_16_16">&#160;</h:panelGroup>
											<f:ajax render=":viewPage :#{rich:clientId('tabPanel')} :citationLink" />
									</h:commandLink>
								</ui:fragment>
								
								
								<h:panelGroup styleClass="eg3_pageScanPagination">
									<!-- left page number -->
									<h:outputText value="#{lbl.list_Scan} #{viewPages.selectedPage.order+1}" rendered="#{viewPages.selectedPage != null}"/>
									<ui:fragment rendered="#{not empty viewPages.selectedPage.orderLabel and viewPages.selectedPage != null}">
										<h:outputText value=" / #{viewPages.selectedPage.orderLabel}" rendered="#{viewPages.selectedPage != null}"/>
									</ui:fragment>
									<ui:fragment rendered="#{viewPages.viewType == 'RECTO_VERSO'}">
										<h:panelGroup styleClass="eg3_separator" rendered="#{viewPages.selectedRightPage != null and viewPages.selectedPage != null}">&#160;</h:panelGroup>
									</ui:fragment>
									
									<ui:remove>
									<!-- page number, if the view isn't Recto Verso -->
									<ui:fragment rendered="#{viewPages.viewType != 'RECTO_VERSO'}">
										<h:outputText value=" /  #{viewPages.volume.pages.size()}"/>
									</ui:fragment>
									</ui:remove>
									
									<!-- right page number -->
									<h:outputText value="#{lbl.list_Scan} #{viewPages.selectedRightPage.order + 1}" rendered="#{viewPages.viewType == 'RECTO_VERSO' and viewPages.selectedRightPage!=null}"/>
									<ui:fragment rendered="#{not empty viewPages.selectedRightPage.orderLabel and viewPages.selectedRightPage != null}">
										<h:outputText value=" / #{viewPages.selectedRightPage.orderLabel}"/>
									</ui:fragment>
									<ui:fragment rendered="#{viewPages.volume.pages.size() > 1}">
										<input type="button" onclick="eg3_switchInputType('.eg3_viewPageMenu .eg3_pageScanPagination', '.eg3_gotoBox', true);" class="eg3_icon_editBtn_16_16"/>
									</ui:fragment>
								</h:panelGroup>
								
								<h:panelGroup styleClass="eg3_gotoBox" >
									<h:selectOneMenu value="#{viewPages.selectedPageNumber}" >
							   			<f:ajax event="change" listener="#{viewPages.pageNumberChanged}" render=":viewPage :#{rich:clientId('tabPanel')} :citationLink"/>
							   			<f:selectItems value="#{viewPages.pageListMenu}" />
							   		</h:selectOneMenu>
						   		</h:panelGroup>
								
								<ui:fragment rendered="#{viewPages.selectedPageNumber lt viewPages.volume.pages.size()}">
									<h:commandLink action="#{viewPages.goToNextPage}" title="#{tlt.paginator_goToNextPage}" >
										<h:panelGroup styleClass="eg3_icon_forward_16_16">&#160;</h:panelGroup>
										<f:ajax render=":viewPage :#{rich:clientId('tabPanel')} :citationLink"/>
									</h:commandLink>
									<h:commandLink action="#{viewPages.goToLastPage}" title="#{tlt.paginator_goToLastPage}">
										<h:panelGroup styleClass="eg3_icon_skipTolast_16_16">&#160;</h:panelGroup>
										<f:ajax render=":viewPage :#{rich:clientId('tabPanel')} :citationLink"/>
									</h:commandLink>
								</ui:fragment>
							</h:form>
						
						</h:panelGroup>
						
						<h:panelGroup layout="block" styleClass="eg3_floatRight eg3_overlay eg3_main_color">
							<h:form>
								<h:panelGroup layout="block" styleClass="eg3_overlayBox">
									<h:panelGroup layout="block" styleClass="eg3_overlayHeader eg3_alternate_color_1">
										<h:panelGroup styleClass="eg3_selectionText"><h:outputText value="#{lbl.export_headline}"/></h:panelGroup>
									</h:panelGroup>
									<h:panelGroup layout="block" styleClass="eg3_overlayBody eg3_right eg3_borderradius_5">
										<ul>
											<li><h:outputLink title="#{tlt.export_page_print}" styleClass="eg3_selectionText" action=""><h:outputText value="#{lbl.export_page_print}"/></h:outputLink></li>
											<li><h:outputLink title="#{tlt.export_as_pdf}" styleClass="eg3_selectionText" action=""><h:outputText value="#{lbl.export_as_pdf}"/></h:outputLink></li>
											<li><h:outputLink title="#{tlt.export_dfg_viewer}" styleClass="eg3_selectionText" action=""><h:outputText value="#{lbl.export_dfg_viewer}"/></h:outputLink></li>
											<li><h:outputLink title="#{tlt.export_mets_mods}" styleClass="eg3_selectionText" action=""><h:outputText value="#{lbl.export_mets_mods}"/></h:outputLink></li>
											<li><h:outputLink title="#{tlt.export_as_tei}" styleClass="eg3_selectionText" action=""><h:outputText value="#{lbl.export_as_tei}"/></h:outputLink></li>
										</ul>
									</h:panelGroup>
								</h:panelGroup>
							</h:form>
							<h:outputText value="&#160;" rendered="#{!viewPages.selectedRightPage.orderLabel}"/>
						</h:panelGroup>
					</h:panelGroup>
					
					
					<!--  SINGLE VIEW  -->
					<h:panelGroup layout="block" styleClass="eg3_singleView eg3_image_bgColor_1" rendered="#{viewPages.viewType == 'SINGLE'}">
	
						<link href="#{facesContext.externalContext.request.contextPath}/resources/components/digilib_jquery/jquery.digilib.css" type="text/css" rel="stylesheet" />
	
						<h:outputScript library="components/digilib_jquery" name="jquery.cookie.js" target="head" rendered="#{viewPages.viewType == 'SINGLE'}"/>
						<h:outputScript library="components/digilib_jquery" name="jquery.digilib.js" target="head" rendered="#{viewPages.viewType == 'SINGLE'}"/>
						<h:outputScript library="components/digilib_jquery" name="jquery.digilib.geometry.js" target="head" rendered="#{viewPages.viewType == 'SINGLE'}"/>
						<h:outputScript library="components/digilib_jquery" name="jquery.digilib.birdseye.js" target="head" rendered="#{viewPages.viewType == 'SINGLE'}"/>
						<h:outputScript library="components/digilib_jquery" name="jquery.digilib.regions.js" target="head" rendered="#{viewPages.viewType == 'SINGLE'}"/>
						
						<ui:fragment rendered="#{viewPages.selectedPage != null}">
							<h:panelGroup layout="block" styleClass="digilib eg3_viewPage_imgContainer">
								<h:graphicImage value="#{volumeUtilBean.getDigilibScalerUrlForPage(viewPages.selectedPage,600,1400)}"/>
							</h:panelGroup>
							
							<h:panelGroup layout="block" styleClass="eg3_permalinkBox eg3_container_1_4 eg3_borderradius_5_top">
								<h:outputText styleClass="eg3_permalinkBoxText" value="#{applicationBean.domain}/#{applicationBean.contextPath}/view/#{viewPages.volumeId}/single/#{viewPages.volume.pages.indexOf(viewPages.selectedPage)+1}" /> 
							</h:panelGroup>
							
							<script type="text/javascript">
					            $(document).ready(function(){
					                var opts = {
					                	interactionMode : 'embedded',
					                    scalerBaseUrl : 'http://latest-coreservice.mpdl.mpg.de/digitallibrary/servlet/Scaler', 
					                    showRegionNumbers : true,
					                    logoUrl: '',
					                    buttonSettings : {
					                        embedded : {
					                            'imagePath' : '#{facesContext.externalContext.request.contextPath}/resources/components/digilib_jquery/img/embedded/16/',
					                            'buttonSetWidth' : 18,
					                            'standardSet' : ["reference","zoomin","zoomout","zoomarea","zoomfull","reset","bird","toggleoptions"],
					                            'specialSet' : ["mark","delmark","hmir","vmir","rot","brgt","cont","rgb","quality","scale","lessoptions"],
					                            'arrowSet' : ["up", "down", "left", "right"],
					                            'buttonSets' : ['standardSet', 'specialSet']
					                            }
					                    }
					                    //, scalerInset : -10
									}; //end opts
									$('.eg3_singleView div.digilib').digilib(opts);
									$('.eg3_singleView div.digilib .keep.buttons').draggable();
					            });
					        </script>
				        </ui:fragment>
					</h:panelGroup>
				
				
					<!-- RECTO VERSO VIEW -->
					<h:panelGroup layout="block" styleClass="eg3_dualView eg3_image_bgColor_1" rendered="#{viewPages.viewType == 'RECTO_VERSO' or viewPages.viewType == 'FULLTEXT'}">
						<h:panelGroup layout="block" styleClass="eg3_viewPage_imgContainer" rendered="#{viewPages.selectedPage!=null}">
							<h:graphicImage value="#{volumeUtilBean.getImageServerUrl(viewPages.selectedPage.contentIds, 'WEB')}"/>
						</h:panelGroup>
						<h:panelGroup layout="block" styleClass="eg3_viewPage_imgContainer #{empty viewPages.selectedPage ? 'eg3_floatRight' : ''}" rendered="#{viewPages.viewType == 'RECTO_VERSO' and viewPages.selectedRightPage!=null}" >
							<h:graphicImage value="#{volumeUtilBean.getImageServerUrl(viewPages.selectedRightPage.contentIds, 'WEB')}"/>
						</h:panelGroup>
						
						
						<h:panelGroup layout="block" styleClass="eg3_container_1_2" rendered="#{viewPages.viewType == 'RECTO_VERSO' and viewPages.selectedRightPage!=null}" >
							<span class="quad_area1 splitBlockHeader">
								<span class="quad_area0_p4 lineToolSection">
									<h:outputLabel styleClass="free_label sectionTool" value="#{lbl.view_dtls_page_txt} #{viewPages.volume.pages.indexOf(viewPages.selectedRightPage)+1} #{lbl.toc_edit_of} #{utilBean.getListSize(viewPages.volume.pages)}"/>
								</span>
							</span>
						</h:panelGroup>
						
						
						<h:panelGroup layout="block" styleClass="eg3_container_1_2 fulltext" rendered="#{viewPages.viewType == 'FULLTEXT'}">
							<h:outputStylesheet name="tei.css" library="cssFramework" target="head"/>
							<span class="quad_area1 splitBlockHeader"></span>
							
							<style type="text/css">
			                    ins{
			                        text-align:right;
			                        font-style:italic;
			                        display:inline-block;
			                        float:right;
			                        text-decoration:none;
			                    }
		                    </style>
							
							<div id="fulltext" class="quad_area1 splitBlockBody noTopBorder sameHeightSlave" style="background-color: white">
								<h:outputText value="#{volumeUtilBean.emphasizeWordsinHtml(viewPages.xhtmlForPage, viewPages.fulltextMatchesAsArray, 'searchHit')}" escape="false" rendered="#{viewPages.volume.teiSd!=null}"/>
							</div>
						</h:panelGroup>	
						
						<!--provenance and url  -->
						<h:panelGroup layout="block" styleClass="eg3_dualView eg3_image_bgColor_1 eg3_container_1">
							<h:panelGroup layout="block" styleClass="eg3_permalinkBox eg3_container_1_4 eg3_borderradius_5_top" 
							              rendered="#{viewPages.selectedPage!=null}">
								<h:outputText styleClass="eg3_permalinkBoxText" 
											  value="#{applicationBean.domain}/#{applicationBean.contextPath}/view/#{viewPages.volumeId}/single/#{viewPages.volume.pages.indexOf(viewPages.selectedPage)+1}" /> 
							</h:panelGroup>
							<h:panelGroup layout="block" styleClass="eg3_permalinkBox eg3_container_1_4 eg3_borderradius_5_top eg3_floatRight" 
							              rendered="#{viewPages.selectedRightPage!=null}">
								<h:outputText styleClass="eg3_permalinkBoxText" 
								              value="#{applicationBean.domain}/#{applicationBean.contextPath}/view/#{viewPages.volumeId}/single/#{viewPages.volume.pages.indexOf(viewPages.selectedRightPage)+1}" /> 
							</h:panelGroup>
						</h:panelGroup>											
					</h:panelGroup>
					
				</h:panelGroup>
				
				
			</h:panelGroup> <ui:remove>end eg3_viewPageContainer</ui:remove>
			
		</ui:define>
	</ui:composition>
</html>
