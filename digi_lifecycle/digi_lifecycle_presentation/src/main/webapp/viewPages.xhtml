<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:fu="http://java.sun.com/jsf/composite/components/fileUpload"
	xmlns:mpdl="http://java.sun.com/jsf/composite/components/mpdl"
	xmlns:load="http://java.sun.com/jsf/composite/components/lazyLoad"
	xmlns:pretty="http://ocpsoft.com/prettyfaces"
	xmlns:modsViewer="http://java.sun.com/jsf/composite/components/mpdl/modsViewer">

	<ui:composition template="templates/template_v3.xhtml">
		
		<ui:define name="separateContentHeader">
			<link href="#{facesContext.externalContext.request.contextPath}/resources/components/digilib_jquery/jquery.digilib.css" type="text/css" rel="stylesheet"/>
	
			<h:outputScript library="components/digilib_jquery" name="jquery.digilib.js" target="head"/>
			<h:outputScript library="components/digilib_jquery" name="jquery.digilib.geometry.js" target="head"/>
			<h:outputScript library="components/digilib_jquery" name="jquery.digilib.birdseye.js" target="head"/>
			<h:outputScript library="components/digilib_jquery" name="jquery.digilib.regions.js" target="head"/>
			<h:outputScript library="components/digilib_jquery" name="jquery.digilib.dlcplugin.js" target="head"/>
		
			<h:panelGroup layout="block" styleClass="eg3_viewPageHeader eg3_container_1_2">
				<h:panelGroup layout="block" styleClass="eg3_container_1">
					<modsViewer:header volume="#{viewPages.volume}" collection="#{viewPages.context}"/>
				</h:panelGroup>
				<h:outputText value="#{msg.warning_itemWithdrawn}" style="color:red" rendered="#{viewPages.volume.item.properties.publicStatus.xmlValue=='withdrawn'}"/>
			</h:panelGroup>
			
			
			
		</ui:define>
		
		<ui:define name="citationLink">
			<script type="text/javascript">
				function activateCitationContent() {
					$('.eg3_citationOverlayArea').show(400);
				}
			</script>
			<h:panelGroup layout="block" styleClass="eg3_container_1_5 eg3_floatRight eg3_citationLinkArea" rendered="#{viewPages.volume.item.properties.publicStatus.xmlValue!='withdrawn'}">
				<input type="button" class="eg3_floatRight" value="#{lbl.view_citationLink}" onclick="activateCitationContent();"/>
			</h:panelGroup>
		</ui:define>
		
		<ui:define name="citationLinkContent">
			<h:panelGroup id="citationOverlayArea" layout="block" styleClass="eg3_citationOverlayArea"  rendered="#{viewPages.volume.item.properties.publicStatus.xmlValue!='withdrawn'}">
				<button class="eg3_container_1" onclick="$(this).parent().hide('slow');">
					<h:panelGroup styleClass="eg3_icon_close_16_16" style="display:inline-block;"/>
				</button>
				
				<h:outputLabel for="bookmarkLink">
					<h:outputText value="Bookmark-URL:"/> <!-- TODO: missing label -->
				</h:outputLabel>
				<h:panelGroup styleClass="eg3_markTextButton">
					<h:outputText value="mark bookmark"/> <!-- TODO: missing label -->
				</h:panelGroup>
				<h:inputText id="bookmarkLink" value="#{applicationBean.domain}/#{applicationBean.contextPath}/view/#{viewPages.volumeId}/#{viewPages.viewTypeText}/#{viewPages.selectedPageNumber}" readonly="true" styleClass="eg3_container_1"/>
				
				<h:outputLabel for="volumeLink">
					<h:outputText value="title handle:"/> <!-- TODO: missing label -->
				</h:outputLabel>
				<h:panelGroup styleClass="eg3_markTextButton">
					<h:outputText value="mark title handle"/> <!-- TODO: missing label -->
				</h:panelGroup>
				<h:inputText id="volumeLink" value="#{applicationBean.domain}/#{applicationBean.contextPath}/view/#{viewPages.volumeId}/#{viewPages.viewTypeText}/#{viewPages.selectedPageNumber}" readonly="true" styleClass="eg3_container_1"/>
				
				<ui:fragment rendered="#{viewPages.viewType == 'SINGLE'}">
					<h:outputLabel for="citSinglePage">
						<h:outputText value="Handle-URL of page:"/> <!-- TODO: missing label -->
					</h:outputLabel>
					<h:panelGroup styleClass="eg3_markTextButton">
						<h:outputText value="mark handle"/> <!-- TODO: missing label -->
					</h:panelGroup>
					<h:inputText id="citSinglePage" value="#{applicationBean.domain}/#{applicationBean.contextPath}/view/#{viewPages.volumeId}/single/#{viewPages.volume.pages.indexOf(viewPages.selectedPage)+1}" readonly="true" styleClass="eg3_container_1"/>
					
					<h:outputLabel for="citDigiView">
						<h:outputText value="DigiLib-View:"/> <!-- TODO: missing label -->
					</h:outputLabel>
					<h:panelGroup styleClass="eg3_markTextButton">
						<h:outputText value="mark URL"/> <!-- TODO: missing label -->
					</h:panelGroup>
					<h:inputText id="citDigiView" value="#{applicationBean.domain}/#{applicationBean.contextPath}/view/#{viewPages.volumeId}/#{viewPages.viewTypeText}/#{viewPages.selectedPageNumber}" readonly="true" styleClass="eg3_container_1"/>
				</ui:fragment>
				
				<ui:fragment rendered="#{viewPages.viewType == 'RECTO_VERSO'}">
					<h:outputLabel for="citLeftPage">
						<h:outputText value="Handle-URL left page:"/> <!-- TODO: missing label -->
					</h:outputLabel>
					<h:panelGroup styleClass="eg3_markTextButton">
						<h:outputText value="mark handle"/> <!-- TODO: missing label -->
					</h:panelGroup>
					<h:inputText id="citLeftPage" value="#{applicationBean.domain}/#{applicationBean.contextPath}/view/#{viewPages.volumeId}/single/#{viewPages.volume.pages.indexOf(viewPages.selectedPage)+1}" readonly="true" styleClass="eg3_container_1"/>
				
					<h:outputLabel for="citRightPage">
						<h:outputText value="Handle-URL right page:"/> <!-- TODO: missing label -->
					</h:outputLabel>
					<h:panelGroup styleClass="eg3_markTextButton">
						<h:outputText value="mark handle"/> <!-- TODO: missing label -->
					</h:panelGroup>
					<h:inputText id="citRightPage" value="#{applicationBean.domain}/#{applicationBean.contextPath}/view/#{viewPages.volumeId}/single/#{viewPages.volume.pages.indexOf(viewPages.selectedRightPage)+1}" readonly="true" styleClass="eg3_container_1"/>
				</ui:fragment>
				
				<ui:fragment rendered="#{viewPages.viewType == 'FULLTEXT'}">
					<h:outputLabel for="citFulltextPage">
						<h:outputText value="Handle-URL of page:"/> <!-- TODO: missing label -->
					</h:outputLabel>
					<h:inputText id="citFulltextPage" value="#{applicationBean.domain}/#{applicationBean.contextPath}/view/#{viewPages.volumeId}/single/#{viewPages.volume.pages.indexOf(viewPages.selectedPage)+1}" readonly="true" styleClass="eg3_container_1"/>
				</ui:fragment>
				
				<script type="text/javascript">
					$('.eg3_markTextButton').bind("click", function(evt, btn){
						$(this).next("input[id]").focus().select();
					});
				</script>
			</h:panelGroup>
		</ui:define>
		
		<ui:define name="mainContent">
			
			<h:panelGroup id="viewPageContainer" layout="block" styleClass="eg3_container_1 eg3_viewPageContainer eg3_content_bgColor_2" rendered="#{viewPages.volume.item.properties.publicStatus.xmlValue!='withdrawn'}">
				<script type="text/javascript">
					var curContent = "toc";
				</script>
			<!-- SIDEBAR LEFT -->
				<h:panelGroup layout="block" styleClass="eg3_id_sidebarLeft eg3_container_1_4">
					<h:form styleClass="eg3_overflow_z50">
						
						<rich:tabPanel id="tabPanel" switchType="ajax">
			     			
			     			<rich:tab header="#{lbl.view_tab_structure}" rendered="#{viewPages.volume.teiSd != null}" id="toc" onenter="scrollTree(); curContent='toc';">
				     			<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_content_bgColor eg3_iconBar eg3_textRight">
				     				<h:commandButton type="button" styleClass="eg3_collapseOverlay eg3_modusBtn eg3_borderradius_5 eg3_icon_resizeSmall_16_16" onclick="eg3_closeOverlay(this, 'toc');" value=" " disabled="true"/>
				     				<h:commandButton type="button" styleClass="eg3_expandOverlay eg3_modusBtn eg3_borderradius_5 eg3_icon_resizeMedium_16_16" onclick="eg3_openOverlay(this, 'toc');" value=" "/>
				     				<ui:remove>
										<input type="button" class="eg3_expandOverlay eg3_modusBtn eg3_borderradius_5" style="width:1.333333em;" onclick="eg3_openOverlay(this, 'toc');" value="+"/>
										<input type="button" class="eg3_collapseOverlay eg3_modusBtn eg3_borderradius_5" style="width:1.333333em;" onclick="eg3_closeOverlay(this, 'toc');" disabled="disabled" value="-"/>
									</ui:remove>
								</h:panelGroup>
								
								<h:panelGroup layout="block" styleClass="eg3_contentDetails eg3_container_1 eg3_overflowAuto eg3_toc" style="height:600px;" id="tocTreeContainer">
									<rich:tree toggleType="ajax" var="divItem">
										<rich:treeModelRecursiveAdaptor roots="#{viewPages.volume.teiSd.pbOrDiv}" nodes="#{divItem.pbOrDiv}">
											<rich:treeNode expanded="#{viewPages.treeExpansionStateMap[divItem]}" rendered="#{divItem.elementType != 'PB'}">
												<mpdl:treeEntry teiElement="#{divItem}" linkAction="#{viewPages.goTo(divItem)}" linkStyleClass="struct_#{divItem.id} #{divItem == viewPages.selectedDiv ? 'eg3_active' : ''}"
																render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationOverlayArea"/>							
											</rich:treeNode>
										</rich:treeModelRecursiveAdaptor>
									</rich:tree>
								</h:panelGroup>
							</rich:tab>
							
							<rich:tab header="#{lbl.view_tab_thumbnails}" id="thumbs" oncomplete="scrollThumbs(); curContent='thumbs';">
								<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_content_bgColor eg3_iconBar eg3_textRight">
									<h:commandButton type="button" styleClass="eg3_collapseOverlay eg3_modusBtn eg3_borderradius_5 eg3_icon_resizeSmall_16_16" onclick="eg3_closeOverlay(this, 'thumbs'); scrollThumbs();" value=" " disabled="true"/>
				     				<h:commandButton type="button" styleClass="eg3_expandOverlay eg3_modusBtn eg3_borderradius_5 eg3_icon_resizeMedium_16_16" onclick="eg3_openOverlay(this, 'thumbs'); scrollThumbs();" value=" "/>
								</h:panelGroup>
								<h:panelGroup id="thumbnailContainer" layout="block" styleClass="eg3_contentDetails eg3_container_1 eg3_overflowAuto" style="height:600px;">
									<h:panelGroup  layout="block" styleClass="eg3_container_1 eg3_thumbContainer">
										
										<a4j:repeat var="var" value="#{viewPages.pageList}" rowKeyVar="rowKey">
											<h:panelGroup layout="block" styleClass=" #{var.id} eg3_container_1_2 eg3_thumbnail #{ (viewPages.viewTypeMap[var] == 'single' ||viewPages.viewTypeMap[var]=='right' || ((viewPages.viewTypeMap[var] != 'single' and viewPages.viewTypeMap[var] != 'left' and viewPages.viewTypeMap[var] != 'right') and (rowKey+1) % 2 == 1)) ? 'eg3_floatNone' : '' }" >
												<h:commandLink  action="#{viewPages.goToPage(var)}">
													<h:graphicImage id="img" value="#{volumeUtilBean.getImageServerUrl(var.contentIds, 'THUMBNAIL')}"/>
													<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationOverlayArea"/>
												</h:commandLink>
												<h:panelGroup styleClass="eg3_thumbnailLabel">
													
													<h:outputText value="#{lbl.list_Page} #{var.orderLabel} / " rendered="#{not empty var.orderLabel}"/>
													<h:outputText value="#{lbl.list_Scan} #{var.order +1} "/>
												</h:panelGroup>
											</h:panelGroup>
										</a4j:repeat>
										
									</h:panelGroup>
								</h:panelGroup>
							</rich:tab>
							
							<rich:tab header="#{lbl.view_tab_biblMd}" id="bibmd" rendered="#{viewPages.volume.modsMetadata != null}" styleClass="eg3_container_1" onmouseover="$('span.double_area0').width('40em'); $('span.double_area0').css('opacity','0.8')" onmouseout="$('span.double_area0').width('18.83em');$('span.double_area0').css('opacity','1');">
								<h:commandButton value="#{lbl.button_command_isbd}">
									<rich:componentControl target="isbdPopup" operation="show"/>
								</h:commandButton>
								<h:panelGroup>
									<modsViewer:default modsMetadata="#{viewPages.volume.modsMetadata}" volumeOu="#{viewPages.volumeOu}" editable="false"/>
									<h:outputLink value="#{viewPages.volumeOu.dlcMd.foafOrganization.cataloguePrefix}#{viewPages.volume.modsMetadata.catalogueId_001}"/>
									
									<!--<h:outputText value="#{viewPages.volume.item.properties.contentModel.objid}"/>  -->
								</h:panelGroup>
							    <rich:popupPanel id="isbdPopup" modal="false" autosized="true">
							        <f:facet name="controls">
							        	<h:commandButton onclick="#{rich:component('isbdPopup')}.hide(); return false;" value=" " styleClass="eg3_icon_close_16_16"/>
							        </f:facet>
							        <h:panelGroup rendered="#{viewPages.volume.item.properties.contentModel.objid == 'escidoc:2001'}">
										<modsViewer:isbd modsMetadata="#{viewPages.volume.modsMetadata}"/>
									</h:panelGroup>
									<h:panelGroup rendered="#{viewPages.volume.item.properties.contentModel.objid == 'escidoc:2003'}">
										<modsViewer:isbd_vol parentVolume="#{viewPages.volume.relatedParentVolume}" modsMetadata="#{viewPages.volume.modsMetadata}"/>
									</h:panelGroup>
							    </rich:popupPanel>	
							</rich:tab>
							
							<rich:tab header="#{lbl.view_tab_description}" id="desc" rendered="#{not empty viewPages.volume.codicological}">  
								<style>
									.cdc
									{
										width:95.95%;
										padding-top:1%;
										padding-left:2%;
									}
									
									.cdcAttr
									{
										width:95.95%;
										padding-top:0%;
										padding-left:5%;
									}
									
									
									.cdcLabelHeader 
									{
										font-weight: bold;
										font-size: 150%;
										margin-top: 5%;
									}
									
									.cdcLabel
									{
										margin-right:2%;
										font-weight: bold;
									}
									
									.cdcValue
									{
										
									}
									
									.cdcLabelAttr
									{
										margin-right:2%;
										font-weight: bold;
									}
									
									.cdcValueAttr
									{
										
									}
								</style>
								
								<h:panelGroup layout="block" styleClass="eg3_contentDetails eg3_container_1 eg3_overflowAuto">
									<h:outputText value="#{viewPages.codicologicalXhtml}" escape="false" />
								</h:panelGroup>
							</rich:tab>
								
						</rich:tabPanel>
					</h:form>
				</h:panelGroup>
				
				<h:panelGroup id="viewPage" layout="block" styleClass="eg3_container_3_4 eg3_viewPage eg3_overflow">
					<script type="text/javascript">
					/* <![CDATA[ */
						
						function resizeFulltext() {
							// function to resize the text-area box on the right side of the image
							// @returns {Boolean}
							var fullText = $('.eg3_viewPage_fulltext .eg3_containerCenter');
							if (fullText && fullText.length > 0) {
								fullText.css('height', Math.ceil($('.eg3_viewPage_imgContainer').height() - 2));
								return false;
							}
						}
						 
						jsf.ajax.addOnEvent(function(e) {	
							//notice the container height for setting a min-height while ajax reloading
							//without a height value the page jump to top because of to slowly image loading
							if (e.status == "begin") {
								$('.eg3_viewPageContainer').css("min-height", $('.eg3_viewPageContainer').height());
								eg3_closeOverlay('.eg3_collapseOverlay', curContent);
							}
							//if the ajax request is success
							//scroll to the right position in sidebar and delete the min-height value of the global parent container for dynamical browser behaviour
							if (e.status=="success") {
								scrollTree();
								scrollThumbs();
								checkSidebarHeight('.eg3_viewPage', "ajax");
								setTimeout("resizeFulltext()", 200);
							}
						});
						
						function scrollTree() {
							var selectedDivId= '#{viewPages.selectedDiv.id}';
							var containerId = "#{rich:clientId('tocTreeContainer')}";
							
							scrollDiv(containerId, 'struct_' + selectedDivId);
							
							resetViewPageContainer();
						}
						
						function scrollThumbs() {
							var selectedPageId= "#{viewPages.selectedPage.id}";
							var selectedRightPageId= "#{viewPages.selectedRightPage.id}";
							
							$('.eg3_id_sidebarLeft .eg3_thumbContainer .eg3_thumbnail').removeClass("eg3_active");
							
							var containerId = "#{rich:clientId('thumbnailContainer')}";
							

							if (selectedPageId) {
								scrollDiv(containerId, selectedPageId);
								$('.' + selectedPageId).addClass("eg3_active");
								if(selectedRightPageId) {
									$('.' + selectedRightPageId).addClass("eg3_active");
								}
							}
							else {
								scrollDiv(containerId, selectedRightPageId);
								$('.' + selectedRightPageId).addClass("eg3_active");
							}
							
						}
						
						function scrollDiv(containerId, scrollToClassId) {
						
							if (containerId && scrollToClassId) {
								//add an backslahs before all colons					
								containerId = containerId.replace(/:/g, "\\:");
								var containerDiv = $('#' + containerId);
								var scrollToElement = $('.' + scrollToClassId);
						
								var pos = scrollToElement.offset();
								if(pos!=null) {
									var containerPos = containerDiv.offset();				
									var currentScroll = containerDiv.scrollTop();				
									var newScrollPos = pos.top - containerPos.top + currentScroll - 50;		
									containerDiv.scrollTop(newScrollPos);
								}		
							}
						
						}
						
						//function to remove the style value min-height in case of ajax functions, e.g. for pagination
						function resetViewPageContainer() 
						{
							var reloadDone = false;
							
							$('.eg3_viewPageContainer .eg3_viewPage_imgContainer').each(function(i) {
								if ($(this).height() > 0) 
								{
									reloadDone = true;
								}
							});
							(reloadDone) ? removeAttributeValue('.eg3_viewPageContainer', "style", "min-height") : setTimeout("resetViewPageContainer()", 25);
						}
						
						
						$(document).ready(function(e) {
							scrollTree();
							scrollThumbs();
							
							checkSidebarHeight('.eg3_viewPage', "init");
							initWindowResizeListener('.eg3_viewPage');
							
							resizeFulltext();
						});
		
						 /* ]]> */
					</script>
					
					<!-- viewPageMenu -->
					<h:panelGroup layout="block" styleClass="eg3_viewPageMenu eg3_overflow">
						<h:panelGroup layout="block" styleClass="eg3_viewModusContainer eg3_container_1_4" rendered="#{viewPages.selectedPage != null or viewPages.selectedRightPage != null}">
							<ui:fragment rendered="#{viewPages.selectedPage != null}">
								<h:form>
									<h:commandLink action="#{viewPages.switchViewType('SINGLE', viewPages.selectedPage)}" styleClass="eg3_border_1_right eg3_borderstyle_2 eg3_modusBtn#{(viewPages.viewType == 'SINGLE') ? ' eg3_active' : ''}" disabled="#{viewPages.viewType == 'SINGLE'}" title="#{tlt.view_page_single}">
										<h:outputText value="#{lbl.view_singlePage}"/>
										<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationOverlayArea"/>
									</h:commandLink>
									
									<h:commandLink action="#{viewPages.switchViewType('RECTO_VERSO', viewPages.selectedPage)}" styleClass="eg3_border_1_right eg3_borderstyle_2 eg3_modusBtn#{(viewPages.viewType == 'RECTO_VERSO') ? ' eg3_active' : ''}" disabled="#{viewPages.viewType == 'RECTO_VERSO'}" title="#{tlt.view_page_rectoVerso}">
										<h:outputText value="#{lbl.view_rectoVersoPage}"/>
										<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationOverlayArea"/>
									</h:commandLink>
									
									<h:commandLink action="#{viewPages.switchViewType('FULLTEXT', viewPages.selectedPage)}" styleClass="eg3_border_1_right eg3_borderstyle_2 eg3_modusBtn#{(viewPages.viewType == 'FULLTEXT') ? ' eg3_active' : ''}" disabled="#{viewPages.viewType == 'FULLTEXT'}" rendered="#{not empty viewPages.volume.teiSd}" title="#{tlt.view_page_transcript}">
										<h:outputText value="#{lbl.view_fulltextPage}"/>
										<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationOverlayArea"/>
									</h:commandLink>
									
									<pretty:link mappingId="fullScreen" styleClass="eg3_modusBtn" title="#{tlt.paginator_switchToFullscreen}">
										<f:param value="#{viewPages.volumeId}" />
										<f:param value="#{viewPages.viewTypeText}" />
										<f:param value="#{viewPages.selectedPageNumber}" />
										<h:outputText value="#{lbl.paginator_switchToFullscreen}"/>
									</pretty:link>
								</h:form>
							</ui:fragment>
							<ui:fragment rendered="#{viewPages.selectedPage == null}">
								<h:form>
									<h:commandLink action="#{viewPages.switchViewType('SINGLE', viewPages.selectedRightPage)}" styleClass="eg3_border_1_right eg3_borderstyle_2 eg3_modusBtn#{(viewPages.viewType == 'SINGLE') ? ' eg3_active' : ''}" disabled="#{viewPages.viewType == 'SINGLE'}" title="#{tlt.view_page_single}">
										<h:outputText value="#{lbl.view_singlePage}"/>
										<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationOverlayArea"/>
									</h:commandLink>
									
									<h:commandLink action="#{viewPages.switchViewType('RECTO_VERSO', viewPages.selectedRightPage)}" styleClass="eg3_border_1_right eg3_borderstyle_2 eg3_modusBtn#{(viewPages.viewType == 'RECTO_VERSO') ? ' eg3_active' : ''}" disabled="#{viewPages.viewType == 'RECTO_VERSO'}" title="#{tlt.view_page_rectoVerso}">
										<h:outputText value="#{lbl.view_rectoVersoPage}"/>
										<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationOverlayArea"/>
									</h:commandLink>
									
									<h:commandLink action="#{viewPages.switchViewType('FULLTEXT', viewPages.selectedRightPage)}" styleClass="eg3_border_1_right eg3_borderstyle_2 eg3_modusBtn#{(viewPages.viewType == 'FULLTEXT') ? ' eg3_active' : ''}" disabled="#{viewPages.viewType == 'FULLTEXT'}" rendered="#{not empty viewPages.volume.teiSd}" title="#{tlt.view_page_transcript}">
										<h:outputText value="#{lbl.view_fulltextPage}"/>
										<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationOverlayArea"/>
									</h:commandLink>
									
									<pretty:link mappingId="fullScreen" styleClass="eg3_modusBtn" title="#{tlt.paginator_switchToFullscreen}">
										<f:param value="#{viewPages.volumeId}" />
										<f:param value="#{viewPages.viewTypeText}" />
										<f:param value="#{viewPages.selectedPageNumber}" />
										<h:outputText value="#{lbl.paginator_switchToFullscreen}"/>
									</pretty:link>
								</h:form>
							</ui:fragment>
							<h:outputText value="&#160;" rendered="#{!viewPages.selectedPage.orderLabel}"/>
						</h:panelGroup>
						
						
						<h:panelGroup id="pageBrowser" layout="block" styleClass="eg3_container_2_3">
							<h:form styleClass="eg3_pageBrowser">
								<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_defaultPagination" style="margin-top:0.25em;">
									<!-- left page number -->
									<h:panelGroup layout="block" styleClass="eg3_container_1_3 eg3_textRight eg3_pagePaginationLabel">
										<ui:fragment rendered="#{not empty viewPages.selectedPage.orderLabel and viewPages.selectedPage != null}">
											<h:outputText value="#{lbl.list_Page} #{viewPages.selectedPage.orderLabel} / " rendered="#{viewPages.selectedPage != null}"/>
										</ui:fragment>
										<h:outputText value="#{lbl.list_Scan} #{viewPages.selectedPage.order+1}" rendered="#{viewPages.selectedPage != null}"/>
										<h:outputText value="&#160;" rendered="#{viewPages.selectedPage == null}"/>
									</h:panelGroup>
									
									<h:panelGroup layout="block" styleClass="eg3_textCenter eg3_paginationButtons">
										<!-- pagination buttons for previous -->
										<ui:fragment rendered="#{viewPages.selectedPageNumber > 1}">
											<h:commandLink action="#{viewPages.goToFirstPage}" title="#{tlt.paginator_goToFirstPage}">
												<h:panelGroup styleClass="eg3_icon_skipTofirst_16_16">&#160;</h:panelGroup>
												<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationOverlayArea"/>
											</h:commandLink>
											<h:commandLink action="#{viewPages.goToPreviousPage}" title="#{tlt.paginator_goToPreviousPage}">
												<h:panelGroup styleClass="eg3_icon_backward_16_16">&#160;</h:panelGroup>
												<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationOverlayArea"/>
											</h:commandLink>
										</ui:fragment>
										<ui:fragment rendered="#{viewPages.selectedPageNumber lt 2}">
											<h:panelGroup styleClass="eg3_icon_skipTofirsti_16_16 eg3_disabled">&#160;</h:panelGroup>
											<h:panelGroup styleClass="eg3_icon_backwardi_16_16 eg3_disabled">&#160;</h:panelGroup>
										</ui:fragment>
										
										<!-- button to switch the inputType -->
										<ui:fragment rendered="#{viewPages.volume.pages.size() > 1}">
											<input type="button" onclick="eg3_switchInputType('.eg3_viewPageMenu .eg3_defaultPagination', '.eg3_quickPagination', true, 'resizeSelectBox()');" class="eg3_icon_editBtn_16_16"/>
										</ui:fragment>
										
										<!-- pagination buttons for next -->
										<ui:fragment rendered="#{viewPages.selectedPageNumber lt viewPages.volume.pages.size()}">
											<h:commandLink action="#{viewPages.goToNextPage}" title="#{tlt.paginator_goToNextPage}">
												<h:panelGroup styleClass="eg3_icon_forward_16_16">&#160;</h:panelGroup>
												<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationOverlayArea"/>
											</h:commandLink>
											<h:commandLink action="#{viewPages.goToLastPage}" title="#{tlt.paginator_goToLastPage}">
												<h:panelGroup styleClass="eg3_icon_skipTolast_16_16">&#160;</h:panelGroup>
												<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationOverlayArea"/>
											</h:commandLink>
										</ui:fragment>
										<ui:fragment rendered="#{viewPages.selectedPageNumber >= viewPages.volume.pages.size()}">
											<h:panelGroup styleClass="eg3_icon_forwardi_16_16 eg3_disabled">&#160;</h:panelGroup>
											<h:panelGroup styleClass="eg3_icon_skipTolasti_16_16 eg3_disabled">&#160;</h:panelGroup>
										</ui:fragment>
									</h:panelGroup>
									
									<!-- right page number -->
									<h:panelGroup layout="block" styleClass="eg3_pagePaginationLabel">
										<ui:fragment rendered="#{not empty viewPages.selectedRightPage.orderLabel and viewPages.selectedRightPage != null}">
											<h:outputText value="#{lbl.list_Page}  #{viewPages.selectedRightPage.orderLabel} / "/>
										</ui:fragment>
										<h:outputText value="#{lbl.list_Scan} #{viewPages.selectedRightPage.order + 1}" rendered="#{viewPages.viewType == 'RECTO_VERSO' and viewPages.selectedRightPage!=null}"/>
									</h:panelGroup>
									
									<ui:remove>
										<h:panelGroup style="margin-left:2%;" styleClass="eg3_floatRight">
											<h:commandButton type="button" styleClass="eg3_icon_viewer_16_16#{(viewPages.viewType == 'SINGLE') ? ' eg3_active' : ''}" title="#{tlt.paginator_goToDLCViewer}"/>
											<h:commandButton type="button" styleClass="eg3_icon_annotation_16_16" title="#{tlt.paginator_goToAnnotation}"/>
										</h:panelGroup>
									</ui:remove>
								</h:panelGroup> <!-- END OF defaultNavigation -->
								
								<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_quickPagination eg3_textCenter">
									<!-- pagination buttons for previous -->
									<h:panelGroup layout="block" styleClass="eg3_container_1_3 eg3_textRight">
										<ui:fragment rendered="#{viewPages.selectedPageNumber > 1}">
											<h:commandLink action="#{viewPages.goToFirstPage}" title="#{tlt.paginator_goToFirstPage}">
												<h:panelGroup styleClass="eg3_icon_skipTofirst_16_16">&#160;</h:panelGroup>
												<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationOverlayArea"/>
											</h:commandLink>
											<h:commandLink action="#{viewPages.goToPreviousPage}" title="#{tlt.paginator_goToPreviousPage}">
												<h:panelGroup styleClass="eg3_icon_backward_16_16">&#160;</h:panelGroup>
													<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationOverlayArea"/>
											</h:commandLink>
										</ui:fragment>
										<ui:fragment rendered="#{viewPages.selectedPageNumber lt 2}">
											<h:panelGroup styleClass="eg3_icon_skipTofirsti_16_16 eg3_disabled">&#160;</h:panelGroup>
											<h:panelGroup styleClass="eg3_icon_backwardi_16_16 eg3_disabled">&#160;</h:panelGroup>
										</ui:fragment>
									</h:panelGroup>
									
									<h:panelGroup layout="block" styleClass="eg3_dynamicSelectBox_js eg3_container_1_3">
										<h:panelGroup layout="block" styleClass="eg3_selectionContent">
											<span class="eg3_selectionText">
												<ui:fragment rendered="#{viewPages.selectedPage != null}">
													<ui:fragment rendered="#{not empty viewPages.selectedPage.orderLabel and viewPages.selectedPage != null}">
														<h:outputText value="#{lbl.list_Page} #{viewPages.selectedPage.orderLabel} / " rendered="#{viewPages.selectedPage != null}"/>
													</ui:fragment>
													<h:outputText value="#{lbl.list_Scan} #{viewPages.selectedPage.order+1}" rendered="#{viewPages.selectedPage != null}"/>
													<h:outputText value="&#160;" rendered="#{viewPages.selectedPage == null}"/>
												</ui:fragment>
												<ui:fragment rendered="#{viewPages.selectedPage == null}">
													<ui:fragment rendered="#{not empty viewPages.selectedRightPage.orderLabel and viewPages.selectedRightPage != null}">
														<h:outputText value="#{lbl.list_Page}  #{viewPages.selectedRightPage.orderLabel} / "/>
													</ui:fragment>
													<h:outputText value="#{lbl.list_Scan} #{viewPages.selectedRightPage.order + 1}" rendered="#{viewPages.viewType == 'RECTO_VERSO' and viewPages.selectedRightPage!=null}"/>
												</ui:fragment>
											</span>
										</h:panelGroup>
										<h:selectOneMenu value="#{viewPages.selectedPageNumber}">
								   			<f:ajax event="change" listener="#{viewPages.pageNumberChanged}" render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationOverlayArea"/>
								   			<f:selectItems value="#{viewPages.pageListMenu}"/>
								   		</h:selectOneMenu>
								   	</h:panelGroup>
								   	
								   	<!-- pagination buttons for next -->
								   	<h:panelGroup styleClass="eg3_floatLeft">
										<ui:fragment rendered="#{viewPages.selectedPageNumber lt viewPages.volume.pages.size()}">
											<h:commandLink action="#{viewPages.goToNextPage}" title="#{tlt.paginator_goToNextPage}">
												<h:panelGroup styleClass="eg3_icon_forward_16_16">&#160;</h:panelGroup>
												<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationOverlayArea"/>
											</h:commandLink>
											<h:commandLink action="#{viewPages.goToLastPage}" title="#{tlt.paginator_goToLastPage}">
												<h:panelGroup styleClass="eg3_icon_skipTolast_16_16">&#160;</h:panelGroup>
		
												<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationOverlayArea"/>
											</h:commandLink>
										</ui:fragment>
										<ui:fragment rendered="#{viewPages.selectedPageNumber >= viewPages.volume.pages.size()}">
											<h:panelGroup styleClass="eg3_icon_forwardi_16_16 eg3_disabled">&#160;</h:panelGroup>
											<h:panelGroup styleClass="eg3_icon_skipTolasti_16_16 eg3_disabled">&#160;</h:panelGroup>
										</ui:fragment>
									</h:panelGroup>
							   	</h:panelGroup>
							</h:form>
						</h:panelGroup>
						
						
						<h:panelGroup layout="block" styleClass="eg3_floatRight eg3_overflow_z20 eg3_main_color eg3_container_1_20 eg3_noWrap" rendered="#{viewPages.volume.item.properties.version.status=='released'}">
							<h:form>
								<h:panelGroup layout="block" styleClass="eg3_overlayBox eg3_overflow_z20">
									<h:panelGroup layout="block" styleClass="eg3_overlayHeader eg3_alternate_color_1">
										<h:panelGroup styleClass="eg3_selectionText"><h:outputText value="#{lbl.export_headline}"/></h:panelGroup>
									</h:panelGroup>
									<h:panelGroup layout="block" styleClass="eg3_overlayBody eg3_posBottom eg3_posRight eg3_overflow_z50">
										<ul>
											<!--  <li><h:outputLink title="#{tlt.export_page_print}" styleClass="eg3_selectionText" 
															  value=""><h:outputText value="#{lbl.export_page_print}"/></h:outputLink></li>
											-->
											<li><h:commandLink title="#{tlt.export_as_pdf}" styleClass="eg3_selectionText" 
															  action="#{viewPages.export('PDF')}"><h:outputText value="#{lbl.export_as_pdf}"/></h:commandLink></li>
											<li><h:outputLink title="#{tlt.export_dfg_viewer}" styleClass="eg3_selectionText"	
															  value="#{applicationBean.dfgUrl}#{applicationBean.domain}/fledgeddata/oai/?verb=GetRecord%26identifier=#{viewPages.volumeIdWithoutObjId}%26metadataPrefix=zvddmets" target="_blank"><h:outputText value="#{lbl.export_dfg_viewer}"/></h:outputLink></li>
											<li><h:outputLink title="#{tlt.export_mods}" styleClass="eg3_selectionText" 
															  value="#{applicationBean.domain}/fledgeddata/oai/?verb=GetRecord&amp;identifier=#{viewPages.volumeIdWithoutObjId}&amp;metadataPrefix=dlc" target="_blank"><h:outputText value="#{lbl.export_mets_mods}"/></h:outputLink></li>															  
											<!--  <li><h:outputLink title="#{tlt.export_oai_dc}" styleClass="eg3_selectionText" 
															  value="#{applicationBean.domain}/fledgeddata/oai/?verb=GetRecord&amp;identifier=#{viewPages.volumeId}&amp;metadataPrefix=oai_dc" target="_blank"><h:outputText value="#{lbl.export_oai_dc}"/></h:outputLink></li>
											-->				  
											<li><h:outputLink title="#{tlt.export_as_tei}" styleClass="eg3_selectionText" 
															  value="#{applicationBean.domain}/fledgeddata/oai/?verb=GetRecord&amp;identifier=#{viewPages.volumeIdWithoutObjId}&amp;metadataPrefix=tei" target="_blank"><h:outputText value="#{lbl.export_as_tei}"/></h:outputLink></li>
										</ul>
									</h:panelGroup>
								</h:panelGroup>
							</h:form>
							<h:outputText value="&#160;" rendered="#{!viewPages.selectedRightPage.orderLabel}"/>
						</h:panelGroup>
					</h:panelGroup>
					
					
					<!--  SINGLE VIEW  -->
					<h:panelGroup layout="block" styleClass="eg3_singleView eg3_image_bgColor_1" rendered="#{viewPages.viewType == 'SINGLE'}">
	
						<ui:fragment rendered="#{viewPages.selectedPage != null}">
							<h:panelGroup layout="block" styleClass="digilib eg3_viewPage_imgContainer eg3_overflow_z20">
								<h:graphicImage value="#{volumeUtilBean.getDigilibScalerUrlForPage(viewPages.selectedPage,600,1400,viewPages.digilibQueryString)}"/>
							</h:panelGroup>
							
							<script type="text/javascript">
							 /* <![CDATA[ */
							 		
					                var opts = {
							            'citationLinkIds' : ['citDigiView'],    
					                	'interactionMode' : 'embedded',
					                    //scalerBaseUrl : 'http://latest-coreservice.mpdl.mpg.de/digitallibrary/servlet/Scaler', 
					                    'showRegionNumbers' : true,
					                    'logoUrl' : '',
					                    'buttonSettings' : {
					                        'embedded' : {
					                            'imagePath' : '#{facesContext.externalContext.request.contextPath}/resources/components/digilib_jquery/img/embedded/16/',
					                            'buttonSetWidth' : 18,
					                            'standardSet' : ["zoomin","zoomout","zoomarea","zoomfull","bird","mark","delmark","rot","brgt","cont","reset"],
					                            'specialSet' : ["hmir","vmir","rot","brgt","cont","rgb","quality","scale","lessoptions"],
					                            //'standardSet' : ["reference","zoomin","zoomout","zoomarea","zoomfull","reset","bird","toggleoptions"],
					                            //'specialSet' : ["mark","delmark","hmir","vmir","rot","brgt","cont","rgb","quality","scale","lessoptions"],
					                            'arrowSet' : ["up", "down", "left", "right"],
					                            'buttonSets' : ['standardSet', 'specialSet']
				                            
					                            }
					                    }
					                    //, scalerInset : -10
									}; //end opts
									var digilibObject = $('.eg3_singleView div.digilib').digilib(opts);
									$('.eg3_singleView div.digilib .keep.buttons').draggable({containment : "parent"});
								    /* ]]> */
					        </script>
				        </ui:fragment>
					</h:panelGroup>
					
					
					<!-- RECTO VERSO VIEW -->
					<h:panelGroup layout="block" styleClass="eg3_dualView eg3_image_bgColor_1" rendered="#{viewPages.viewType == 'RECTO_VERSO' or viewPages.viewType == 'FULLTEXT'}">
						<h:panelGroup layout="block" styleClass="eg3_viewPage_imgContainer" rendered="#{viewPages.selectedPage!=null}">
							<h:graphicImage value="#{volumeUtilBean.getImageServerUrl(viewPages.selectedPage.contentIds, 'WEB')}"/>
						</h:panelGroup>
						<h:panelGroup layout="block" styleClass="eg3_viewPage_imgContainer #{empty viewPages.selectedPage ? 'eg3_floatRight' : ''}" rendered="#{viewPages.viewType == 'RECTO_VERSO' and viewPages.selectedRightPage!=null}">
							<h:graphicImage value="#{volumeUtilBean.getImageServerUrl(viewPages.selectedRightPage.contentIds, 'WEB')}"/>
						</h:panelGroup>
						
						<h:panelGroup layout="block" styleClass="eg3_container_1_2 eg3_viewPage_fulltext eg3_content_bgColor" rendered="#{viewPages.viewType == 'FULLTEXT'}">
							<h:outputStylesheet name="tei.css" library="cssFramework" target="head"/>
							<h:panelGroup layout="block" id="fulltext" styleClass="eg3_container_9_10 eg3_containerCenter">
								<h:outputText value="#{volumeUtilBean.emphasizeWordsinHtml(viewPages.xhtmlForPage, viewPages.fulltextMatchesAsArray, 'eg3_searchHit')}" escape="false" rendered="#{viewPages.volume.teiSd!=null}"/>
							</h:panelGroup>
						</h:panelGroup>	

					
					<!-- END OF RECTO_VERSO & FULLTEXT -->
					</h:panelGroup>
					
			<!-- END OF viewPage container -->	
				</h:panelGroup>
				
		<!-- end eg3_viewPageContainer -->
			</h:panelGroup>
		</ui:define>
	</ui:composition>
</html>