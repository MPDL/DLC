<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:fu="http://java.sun.com/jsf/composite/components/fileUpload"
	xmlns:mpdl="http://java.sun.com/jsf/composite/components/mpdl"
	xmlns:load="http://java.sun.com/jsf/composite/components/lazyLoad"
	xmlns:pretty="http://ocpsoft.com/prettyfaces"
	xmlns:modsViewer="http://java.sun.com/jsf/composite/components/mpdl/modsViewer">

	<ui:composition template="templates/template_v3.xhtml">
		
		<ui:define name="separateContentHeader">
			<link href="#{facesContext.externalContext.request.contextPath}/resources/components/digilib_jquery/jquery.digilib.css" type="text/css" rel="stylesheet" />
	
			<h:outputScript library="components/digilib_jquery" name="jquery.cookie.js" target="head" />
			<h:outputScript library="components/digilib_jquery" name="jquery.digilib.js" target="head" />
			<h:outputScript library="components/digilib_jquery" name="jquery.digilib.geometry.js" target="head" />
			<h:outputScript library="components/digilib_jquery" name="jquery.digilib.birdseye.js" target="head"/>
			<h:outputScript library="components/digilib_jquery" name="jquery.digilib.regions.js" target="head" />
			<h:outputScript library="components/digilib_jquery" name="jquery.digilib.dlcplugin.js" target="head" />
		
			<h:panelGroup layout="block" styleClass="eg3_viewPageHeader eg3_container_1_2">
				<h:panelGroup layout="block" styleClass="eg3_container_1">
					<h:panelGroup layout="block" styleClass="eg3_detailItemHeader">
						<ui:fragment rendered="#{not empty viewCollection.col.id}">
							<h3 class="eg3_multiVolumeTitle">
								<pretty:link mappingId="volumes">
									<f:param value="#{viewCollection.col.id}" />
									<h:outputText value="#{viewPages.context.properties.name}"/>
								</pretty:link>
							</h3>
						</ui:fragment>
						<br />
						<ui:remove>
						<h:panelGroup styleClass="eg3_icon_multiVolume_32_32">&#160;</h:panelGroup>
						</ui:remove>
						<h:panelGroup styleClass="eg3_floatLeft">
							<h3 class="eg3_volumeTitle">
								<h:panelGroup rendered="#{not empty volumeUtilBean.getFirstAuthor(viewPages.volume.modsMetadata).name}">
									<h:outputText value="#{volumeUtilBean.getFirstAuthor(viewPages.volume.modsMetadata).name}: "  rendered="#{not empty volumeUtilBean.getFirstAuthor(viewPages.volume.modsMetadata).name}"/>
								</h:panelGroup>
								<h:outputText value="#{volumeUtilBean.getTitle(viewPages.volume.modsMetadata).title}"  rendered="#{not empty volumeUtilBean.getTitle(viewPages.volume.modsMetadata).title}"/>
								<h:panelGroup rendered="#{empty volumeUtilBean.getFirstAuthor(viewPages.volume.modsMetadata).name}">
									<h:outputText value=" / #{volumeUtilBean.getFirstEditor(viewPages.volume.modsMetadata).name} (#{lbl.view_dtls_editor_suffix}.)"  rendered="#{not empty volumeUtilBean.getFirstEditor(viewPages.volume.modsMetadata).name}"/>
								</h:panelGroup>
				
								<h:outputText value=". - #{volumeUtilBean.getPublisher(viewPages.volume.modsMetadata).place}" rendered="#{not empty volumeUtilBean.getPublisher(viewPages.volume.modsMetadata).place}"/>
								<h:outputText value=" : #{volumeUtilBean.getPublisher(viewPages.volume.modsMetadata).publisher}" rendered="#{not empty volumeUtilBean.getPublisher(viewPages.volume.modsMetadata).publisher}"/>
								<h:outputText value=", #{volumeUtilBean.getPublisher(viewPages.volume.modsMetadata).dateIssued_425.date}" rendered="#{not empty volumeUtilBean.getPublisher(viewPages.volume.modsMetadata).dateIssued_425.date}"/>
								<h:outputText value="."/>
							
							
							</h3>
							<h4 class="eg3_volumeDetails"><h:outputText value="#{volumeUtilBean.getFirstEditor(viewPages.volume.modsMetadata).name}"/></h4>
						</h:panelGroup>
					</h:panelGroup>
				</h:panelGroup>
			</h:panelGroup>
		</ui:define>
		
		<ui:define name="citationLinkContent">
			<h:panelGroup layout="block" styleClass="eg3_container_1_5 eg3_floatRight eg3_citationLinkArea">
				<input type="button" class="eg3_floatRight" value="#{lbl.view_citationLink}" onclick="$('.eg3_citationLink').toggle();" style="margin-left:2%; background-color:transparent;"/>
				<br />
				<h:inputText id="citationLink" value="#{applicationBean.domain}/#{applicationBean.contextPath}/view/#{viewPages.volumeId}/#{viewPages.viewTypeText}/#{viewPages.selectedPageNumber}" readonly="true" styleClass="eg3_citationLink eg3_floatRight"/>
			</h:panelGroup>
		</ui:define>
		<ui:remove>
		<ui:define name="breadcrumpTitle">			
			<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_breadTitle" style="background-color:#323232;">
				<mpdl:hierarchicalBreadcrumb ou="#{hierarchicalBreadcrumbHelper.getVolumeCollection(viewPages.volume)}" colId="#{viewPages.volume.item.properties.context.objid}" colName="#{viewPages.volume.item.properties.context.getXLinkTitle()}" volumes="true">
				</mpdl:hierarchicalBreadcrumb>
			</h:panelGroup>	
		</ui:define>
		</ui:remove>
		<ui:define name="mainContent">
			<h:panelGroup styleClass="eg3_hidden">
				<ui:repeat value="#{viewPages.pageList}" var="page">
				<h:graphicImage id="img" value="#{volumeUtilBean.getImageServerUrl(page.contentIds, 'THUMBNAIL')}" style="width:60px;" />
				</ui:repeat>
			</h:panelGroup>
			<h:panelGroup id="viewPageContainer" layout="block" styleClass="eg3_container_1 eg3_viewPageContainer eg3_content_bgColor_2">
				<!-- SIDEBAR LEFT -->
				<h:panelGroup layout="block" styleClass="eg3_id_sidebarLeft eg3_container_1_4">
					<h:form styleClass="eg3_overflow_z50">
						
					
						<rich:tabPanel id="tabPanel" switchType="ajax" >
							
							
							
			     			
			     			<rich:tab header="#{lbl.view_tab_structure}" rendered="#{viewPages.volume.teiSd != null}" id="toc" onenter="scrollTree();" >
				     			<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_content_bgColor eg3_iconBar eg3_textRight">
									<input type="button" class="eg3_expandOverlay eg3_modusBtn eg3_borderradius_5" style="width:1.333333em;" onclick="eg3_openOverlay(this, 'toc');" value="+"/>
									<input type="button" class="eg3_collapseOverlay eg3_modusBtn eg3_borderradius_5" style="width:1.333333em;" onclick="eg3_closeOverlay(this, 'toc');" disabled="disabled" value="-"/>
									<input type="button" class="eg3_modusBtn eg3_borderradius_5" value="print"/>
								</h:panelGroup>
								
								<h:panelGroup layout="block" styleClass="eg3_contentDetails eg3_container_1 eg3_overflowAuto" style="height:600px;" id="tocTreeContainer" >
									<rich:tree toggleType="ajax" var="divItem" >
										<rich:treeModelRecursiveAdaptor roots="#{viewPages.volume.teiSd.pbOrDiv}" nodes="#{divItem.pbOrDiv}">
											<rich:treeNode expanded="#{viewPages.treeExpansionStateMap[divItem]}" rendered="#{divItem.elementType != 'PB'}">
												<mpdl:treeEntry teiElement="#{divItem}" linkAction="#{viewPages.goTo(divItem)}" linkStyleClass="struct_#{divItem.id} #{divItem == viewPages.selectedDiv ? 'eg3_active' : ''}"
																render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationLink"/>							
											</rich:treeNode>
										</rich:treeModelRecursiveAdaptor>
									</rich:tree>
								</h:panelGroup>
							</rich:tab>
							
							<rich:tab header="#{lbl.view_tab_thumbnails}" id="thumbs" onenter="scrollThumbs();">
								<h:panelGroup layout="block" styleClass="eg3_container_1 eg3_content_bgColor eg3_iconBar eg3_textRight">
									<input type="button" class="eg3_expandOverlay eg3_modusBtn eg3_borderradius_5" style="width:1.333333em;" onclick="eg3_openOverlay(this, 'thumbs');" value="+"/>
									<input type="button" class="eg3_collapseOverlay eg3_modusBtn eg3_borderradius_5" style="width:1.333333em;" onclick="eg3_closeOverlay(this, 'thumbs');" disabled="disabled" value="-"/>
								</h:panelGroup>
								<h:panelGroup id="thumbnailContainer" layout="block" styleClass="eg3_contentDetails eg3_container_1 eg3_overflowAuto" style="height:600px;">
									<h:panelGroup  layout="block" styleClass="eg3_container_1 eg3_thumbContainer">
										<a4j:repeat var="var" value="#{viewPages.pageList}">
											<h:panelGroup layout="block" styleClass=" #{var.id} eg3_container_1_2 eg3_thumbnail">
												<h:commandLink  action="#{viewPages.goToPage(var)}">
													<h:graphicImage id="img" value="#{volumeUtilBean.getImageServerUrl(var.contentIds, 'THUMBNAIL')}" />
													<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationLink"/>
												</h:commandLink>
												<h:panelGroup styleClass="eg3_thumbnailLabel">
													<h:outputText value="#{lbl.list_Scan} #{var.order +1} "/>
													<h:outputText value="/ #{lbl.list_Page} #{var.orderLabel} " rendered="#{not empty var.orderLabel}"/>
												</h:panelGroup>
											</h:panelGroup>
										</a4j:repeat>
									</h:panelGroup>
								</h:panelGroup>
							</rich:tab>
							
							<rich:tab header="#{lbl.view_tab_biblMd}" id="bibmd" style="width:40em" onmouseover="$('span.double_area0').width('40em'); $('span.double_area0').css('opacity','0.8')" onmouseout="$('span.double_area0').width('18.83em');$('span.double_area0').css('opacity','1');">
								<h:commandButton value="#{lbl.button_command_isbd}">
									<rich:componentControl target="isbdPopup" operation="show" />
								</h:commandButton>
								<h:panelGroup>
									<modsViewer:default modsMetadata="#{viewPages.volume.modsMetadata}" editable="false"/>
									<h:outputLink value="#{viewPages.volumeOu.dlcMd.foafOrganization.cataloguePrefix}#{viewPages.volume.modsMetadata.catalogueId_001}" />


									<!--<h:outputText value="#{viewPages.volume.item.properties.contentModel.objid}" />  -->
								</h:panelGroup>
							    <rich:popupPanel id="isbdPopup" modal="false" autosized="true" >
							        <f:facet name="controls">
							            <h:outputLink value="#" onclick="#{rich:component('isbdPopup')}.hide(); return false;">  X </h:outputLink>
							        </f:facet>
							        <h:panelGroup rendered="#{viewPages.volume.item.properties.contentModel.objid == 'escidoc:2001'}">
										<modsViewer:isbd modsMetadata="#{viewPages.volume.modsMetadata}" />
									</h:panelGroup>
									<h:panelGroup rendered="#{viewPages.volume.item.properties.contentModel.objid == 'escidoc:2003'}">
										<modsViewer:isbd_vol parentVolume="#{viewPages.volume.relatedParentVolume}" modsMetadata="#{viewPages.volume.modsMetadata}" />
									</h:panelGroup>
							    </rich:popupPanel>							
							</rich:tab>
							
							<rich:tab header="#{lbl.view_tab_description}" id="desc">
								
							</rich:tab>
						</rich:tabPanel>
				
					</h:form>
				</h:panelGroup>
				
				<h:panelGroup id="viewPage" layout="block" styleClass="eg3_container_3_4 eg3_viewPage">
					<script type="text/javascript">
							 /* <![CDATA[ */
							jsf.ajax.addOnEvent(function(e)
									{	
										
										//notice the container height for setting a min-height while ajax reloading
										//without a height value the page jump to top because of to slowly image loading
										if (e.status == "begin") {
											$('.eg3_viewPageContainer').css("min-height", $('.eg3_viewPageContainer').height());
											eg3_closeOverlay('.eg3_collapseOverlay');
										}
										//if the ajax request is success
										//scroll to the right position in sidebar and delete the min-height value of the global parent container for dynamical browser behaviour
										if(e.status=="success")
										{
											//scrollTree();
											//scrollThumbs();
										}
									});
									
									function scrollTree()
									{
										var selectedDivId= '#{viewPages.selectedDiv.id}';
										var containerId = "#{rich:clientId('tocTreeContainer')}";
										
									
										scrollDiv(containerId, 'struct_' + selectedDivId);

										resetViewPageContainer();
										checkSidebarHeight('.eg3_viewPage');
										
										
										
									}

									function scrollThumbs()
									{

										
										var selectedPageId= "#{viewPages.selectedPage.id}";
										if(!selectedPageId)
										{
											selectedPageId = "#{viewPages.selectedRightPage.id}"
										}
										
										var containerId = "#{rich:clientId('thumbnailContainer')}";
										
										scrollDiv(containerId, selectedPageId);
										
										

									}

									function scrollDiv(containerId, scrollToClassId)
									{

										if(containerId && scrollToClassId)
										{
											//add an backslahs before all colons					
											containerId = containerId.replace(/:/g, "\\:");
											var containerDiv = $('#' + containerId);
											var scrollToElement = $('.' + scrollToClassId);

											var pos = scrollToElement.offset();
											if(pos!=null)
											{
												var containerPos = containerDiv.offset();				
												var currentScroll = containerDiv.scrollTop();				
												var newScrollPos = pos.top - containerPos.top + currentScroll - 50;		
												containerDiv.scrollTop(newScrollPos);
											}		
										}

									}
									
									function resetViewPageContainer() 
									{
										var reloadDone = false;
										
										$('.eg3_viewPageContainer .eg3_viewPage_imgContainer').each(function(i) 
										{
											if ($(this).height() > 0) 
											{
												reloadDone = true;
											}
										});
										(reloadDone) ? removeAttributeValue('.eg3_viewPageContainer', "style", "min-height") : setTimeout("resetViewPageContainer()", 25);
									}
									
									$(document).ready(function(e)
									{
										scrollTree();
										scrollThumbs();
										
										$(window).resize(function(e)
										{
											resizeSidebar('.eg3_viewPage');
										});
										
										checkSidebarHeight('.eg3_viewPage');
										
									});
									 /* ]]> */
								</script>
					
					
					
					
					<!-- viewPageMenu -->
					<h:panelGroup layout="block" styleClass="eg3_viewPageMenu eg3_textCenter eg3_overflow">
						<h:panelGroup layout="block" styleClass="eg3_viewModusContainer" rendered="#{viewPages.selectedPage != null or viewPages.selectedRightPage != null}">
							<ui:fragment rendered="#{viewPages.selectedPage != null}">
								<h:form>
									<h:commandLink action="#{viewPages.switchViewType('SINGLE', viewPages.selectedPage)}" styleClass="eg3_modusBtn" disabled="#{viewPages.viewType == 'SINGLE'}" title="#{tlt.view_page_single}">
										<h:outputText value="#{lbl.view_singlePage}"/>
										<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationLink"/>
									</h:commandLink>
									
									<h:commandLink action="#{viewPages.switchViewType('RECTO_VERSO', viewPages.selectedPage)}" styleClass="eg3_modusBtn" disabled="#{viewPages.viewType == 'RECTO_VERSO'}" title="#{tlt.view_page_rectoVerso}">
										<h:outputText value="#{lbl.view_rectoVersoPage}"/>
										<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationLink"/>
									</h:commandLink>
									
									<h:commandLink action="#{viewPages.switchViewType('FULLTEXT', viewPages.selectedPage)}" styleClass="eg3_modusBtn" disabled="#{viewPages.viewType == 'FULLTEXT'}" rendered="#{not empty viewPages.volume.teiSd}" title="#{tlt.view_page_transcript}">
										<h:outputText value="#{lbl.view_fulltextPage}"/>
										<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationLink"/>
									</h:commandLink>
									
									<h:commandLink action="#{viewPages.switchViewType('FULLTEXT', viewPages.selectedPage)}" styleClass="eg3_modusBtn" disabled="true" rendered="#{not empty viewPages.volume.teiSd}" title="">
										<h:outputText value="#{lbl.view_xmlPage}"/>
										<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationLink"/>
									</h:commandLink>
								</h:form>
							</ui:fragment>
							<ui:fragment rendered="#{viewPages.selectedPage == null}">
								<h:form>
									<h:commandLink action="#{viewPages.switchViewType('SINGLE', viewPages.selectedRightPage)}" styleClass="eg3_modusBtn eg3_firstBtn" disabled="#{viewPages.viewType == 'SINGLE'}" title="#{tlt.view_page_single}">
										<h:outputText value="#{lbl.view_singlePage}"/>
										<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationLink"/>
									</h:commandLink>
									
									<h:commandLink action="#{viewPages.switchViewType('RECTO_VERSO', viewPages.selectedRightPage)}" styleClass="eg3_modusBtn" disabled="#{viewPages.viewType == 'RECTO_VERSO'}" title="#{tlt.view_page_rectoVerso}">
										<h:outputText value="#{lbl.view_rectoVersoPage}"/>
										<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationLink"/>
									</h:commandLink>
									
									<h:commandLink action="#{viewPages.switchViewType('FULLTEXT', viewPages.selectedRightPage)}" styleClass="eg3_modusBtn" disabled="#{viewPages.viewType == 'FULLTEXT'}" rendered="#{not empty viewPages.volume.teiSd}" title="#{tlt.view_page_transcript}">
										<h:outputText value="#{lbl.view_fulltextPage}"/>
										<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationLink"/>
									</h:commandLink>
									
									<h:commandLink action="#{viewPages.switchViewType('FULLTEXT', viewPages.selectedRightPage)}" styleClass="eg3_modusBtn" disabled="true" rendered="#{not empty viewPages.volume.teiSd}" title="">
										<h:outputText value="#{lbl.view_xmlPage}"/>
										<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationLink"/>
									</h:commandLink>
								</h:form>
							</ui:fragment>
							
							<ui:remove>
								<h:outputText value="&#160;" rendered="#{empty viewPages.selectedPage}"/>
							</ui:remove>
							
							<h:outputText value="&#160;" rendered="#{!viewPages.selectedPage.orderLabel}"/>
						</h:panelGroup>
						
						<h:panelGroup id="pageBrowser" styleClass="eg3_textCenter">
							<h:form styleClass="eg3_pageBrowser">
								<ui:fragment rendered="#{viewPages.selectedPageNumber > 1}">
									<h:commandLink action="#{viewPages.goToFirstPage}" title="#{tlt.paginator_goToFirstPage}">
										<h:panelGroup styleClass="eg3_icon_skipTofirst_16_16">&#160;</h:panelGroup>
										<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationLink"/>
									</h:commandLink>
									<h:commandLink action="#{viewPages.goToPreviousPage}" title="#{tlt.paginator_goToPreviousPage}">
										<h:panelGroup styleClass="eg3_icon_backward_16_16">&#160;</h:panelGroup>
											<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationLink" />
									</h:commandLink>
								</ui:fragment>
								
								
								<h:panelGroup styleClass="eg3_pageScanPagination">
									<!-- left page number -->
									<h:outputText value="#{lbl.list_Scan} #{viewPages.selectedPage.order+1}" rendered="#{viewPages.selectedPage != null}"/>
									<ui:fragment rendered="#{not empty viewPages.selectedPage.orderLabel and viewPages.selectedPage != null}">
										<h:outputText value=" / #{viewPages.selectedPage.orderLabel}" rendered="#{viewPages.selectedPage != null}"/>
									</ui:fragment>
									
									
									<ui:fragment rendered="#{viewPages.viewType == 'RECTO_VERSO' and viewPages.selectedPageNumber gt 1 and viewPages.selectedPageNumber lt viewPages.volume.pages.size()}">
										<h:panelGroup styleClass="eg3_separator">&#160;&#160;</h:panelGroup>
									</ui:fragment>
									
									
									<ui:remove>
									<!-- page number, if the view isn't Recto Verso -->
									<ui:fragment rendered="#{viewPages.viewType != 'RECTO_VERSO'}">
										<h:outputText value=" /  #{viewPages.volume.pages.size()}"/>
									</ui:fragment>
									</ui:remove>
									
									<!-- right page number -->
									<h:outputText value="#{lbl.list_Scan} #{viewPages.selectedRightPage.order + 1}" rendered="#{viewPages.viewType == 'RECTO_VERSO' and viewPages.selectedRightPage!=null}"/>
									<ui:fragment rendered="#{not empty viewPages.selectedRightPage.orderLabel and viewPages.selectedRightPage != null}">
										<h:outputText value=" / #{viewPages.selectedRightPage.orderLabel}"/>
									</ui:fragment>
									<ui:fragment rendered="#{viewPages.volume.pages.size() > 1}">
										<input type="button" onclick="eg3_switchInputType('.eg3_viewPageMenu .eg3_pageScanPagination', '.eg3_gotoBox', true);" class="eg3_icon_editBtn_16_16"/>
									</ui:fragment>
								</h:panelGroup>
								
								<h:panelGroup styleClass="eg3_gotoBox" >
									<h:selectOneMenu value="#{viewPages.selectedPageNumber}" >
							   			<f:ajax event="change" listener="#{viewPages.pageNumberChanged}" render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationLink"/>
							   			<f:selectItems value="#{viewPages.pageListMenu}" />
							   		</h:selectOneMenu>
						   		</h:panelGroup>
								
								<ui:fragment rendered="#{viewPages.selectedPageNumber lt viewPages.volume.pages.size()}">
									<h:commandLink action="#{viewPages.goToNextPage}" title="#{tlt.paginator_goToNextPage}" >
										<h:panelGroup styleClass="eg3_icon_forward_16_16">&#160;</h:panelGroup>
										<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationLink"/>
									</h:commandLink>
									<h:commandLink action="#{viewPages.goToLastPage}" title="#{tlt.paginator_goToLastPage}">
										<h:panelGroup styleClass="eg3_icon_skipTolast_16_16">&#160;</h:panelGroup>
										<f:ajax render=":viewPage #{empty rich:clientId('tocTreeContainer') ? '' : ':'.concat(rich:clientId('tocTreeContainer'))} :citationLink"/>
									</h:commandLink>
								</ui:fragment>
							</h:form>
						
						</h:panelGroup>
						
						<h:panelGroup layout="block" styleClass="eg3_floatRight eg3_overflow_z20 eg3_main_color">
							<h:form>
								<h:panelGroup layout="block" styleClass="eg3_overlayBox eg3_overflow">
									<h:panelGroup layout="block" styleClass="eg3_overlayHeader eg3_alternate_color_1">
										<h:panelGroup styleClass="eg3_selectionText"><h:outputText value="#{lbl.export_headline}"/></h:panelGroup>
									</h:panelGroup>
									<h:panelGroup layout="block" styleClass="eg3_overlayBody eg3_right eg3_borderradius_5">
										<ul>
											<!--  <li><h:outputLink title="#{tlt.export_page_print}" styleClass="eg3_selectionText" 
															  value=""><h:outputText value="#{lbl.export_page_print}"/></h:outputLink></li>
											-->
											<li><h:commandLink title="#{tlt.export_as_pdf}" styleClass="eg3_selectionText" 
															  action="#{viewPages.export('PDF')}"><h:outputText value="#{lbl.export_as_pdf}"/></h:commandLink></li>
											<li><h:outputLink title="#{tlt.export_dfg_viewer}" styleClass="eg3_selectionText"	
															  value="#{applicationBean.dfgUrl}#{applicationBean.domain}/fledgeddata/oai/?verb=GetRecord&amp;identifier=#{viewPages.volumeIdWithoutObjId}&amp;metadataPrefix=zvddmets" target="_blank"><h:outputText value="#{lbl.export_dfg_viewer}"/></h:outputLink></li>
											<li><h:outputLink title="#{tlt.export_mods}" styleClass="eg3_selectionText" 
															  value="#{applicationBean.domain}/fledgeddata/oai/?verb=GetRecord&amp;identifier=#{viewPages.volumeIdWithoutObjId}&amp;metadataPrefix=dlc" target="_blank"><h:outputText value="#{lbl.export_mets_mods}"/></h:outputLink></li>															  
											<!--  <li><h:outputLink title="#{tlt.export_oai_dc}" styleClass="eg3_selectionText" 
															  value="#{applicationBean.domain}/fledgeddata/oai/?verb=GetRecord&amp;identifier=#{viewPages.volumeId}&amp;metadataPrefix=oai_dc" target="_blank"><h:outputText value="#{lbl.export_oai_dc}"/></h:outputLink></li>
											-->				  
											<li><h:outputLink title="#{tlt.export_as_tei}" styleClass="eg3_selectionText" 
															  value="#{applicationBean.domain}/fledgeddata/oai/?verb=GetRecord&amp;identifier=#{viewPages.volumeIdWithoutObjId}&amp;metadataPrefix=tei" target="_blank"><h:outputText value="#{lbl.export_as_tei}"/></h:outputLink></li>
										</ul>
									</h:panelGroup>
								</h:panelGroup>
							</h:form>
							<h:outputText value="&#160;" rendered="#{!viewPages.selectedRightPage.orderLabel}"/>
						</h:panelGroup>
					</h:panelGroup>
					
					
					<!--  SINGLE VIEW  -->
					<h:panelGroup layout="block" styleClass="eg3_singleView eg3_image_bgColor_1" rendered="#{viewPages.viewType == 'SINGLE'}">
	
						
						
						<ui:fragment rendered="#{viewPages.selectedPage != null}">
							<h:panelGroup layout="block" styleClass="digilib eg3_viewPage_imgContainer">
								<h:graphicImage value="#{volumeUtilBean.getDigilibScalerUrlForPage(viewPages.selectedPage,600,1400)}#{viewPages.digilibQueryString}"/>
							</h:panelGroup>
							
							<h:panelGroup layout="block" styleClass="eg3_permalinkBox eg3_container_1_2 eg3_containerCenter eg3_borderradius_5_top">
								<h:inputText id="permaLink" styleClass="eg3_permalinkBoxText" value="#{applicationBean.domain}/#{applicationBean.contextPath}/view/#{viewPages.volumeId}/single/#{viewPages.volume.pages.indexOf(viewPages.selectedPage)+1}" readonly="true"/> 
							</h:panelGroup>
							
							<script type="text/javascript">
							 /* <![CDATA[ */
							 		
					                var opts = {
							            'citationLinkIds' : ['citationLink','permaLink'],    
					                	'interactionMode' : 'embedded',
					                    //scalerBaseUrl : 'http://latest-coreservice.mpdl.mpg.de/digitallibrary/servlet/Scaler', 
					                    'showRegionNumbers' : true,
					                    'logoUrl' : '',
					                    'buttonSettings' : {
					                        'embedded' : {
					                            'imagePath' : '#{facesContext.externalContext.request.contextPath}/resources/components/digilib_jquery/img/embedded/16/',
					                            'buttonSetWidth' : 18,
					                            'standardSet' : ["zoomin","zoomout","zoomarea","zoomfull","bird","mark","delmark","rot","brgt","cont","reset"],
					                            'specialSet' : ["hmir","vmir","rot","brgt","cont","rgb","quality","scale","lessoptions"],
					                            //'standardSet' : ["reference","zoomin","zoomout","zoomarea","zoomfull","reset","bird","toggleoptions"],
					                            //'specialSet' : ["mark","delmark","hmir","vmir","rot","brgt","cont","rgb","quality","scale","lessoptions"],
					                            'arrowSet' : ["up", "down", "left", "right"],
					                            'buttonSets' : ['standardSet', 'specialSet']
				                            
					                            }
					                    }
					                    //, scalerInset : -10
									}; //end opts
									var digilibObject = $('.eg3_singleView div.digilib').digilib(opts);
									$('.eg3_singleView div.digilib .keep.buttons').draggable({containment : "parent"});
								    /* ]]> */
					        </script>
				        </ui:fragment>
					</h:panelGroup>
				
				
					<!-- RECTO VERSO VIEW -->
					<h:panelGroup layout="block" styleClass="eg3_dualView eg3_image_bgColor_1" rendered="#{viewPages.viewType == 'RECTO_VERSO' or viewPages.viewType == 'FULLTEXT'}">
						<h:panelGroup layout="block" styleClass="eg3_viewPage_imgContainer" rendered="#{viewPages.selectedPage!=null}">
							<h:graphicImage value="#{volumeUtilBean.getImageServerUrl(viewPages.selectedPage.contentIds, 'WEB')}"/>
						</h:panelGroup>
						<h:panelGroup layout="block" styleClass="eg3_viewPage_imgContainer #{empty viewPages.selectedPage ? 'eg3_floatRight' : ''}" rendered="#{viewPages.viewType == 'RECTO_VERSO' and viewPages.selectedRightPage!=null}" >
							<h:graphicImage value="#{volumeUtilBean.getImageServerUrl(viewPages.selectedRightPage.contentIds, 'WEB')}"/>
						</h:panelGroup>
						
						<ui:remove>
						<h:panelGroup layout="block" styleClass="eg3_container_1_2" rendered="#{viewPages.viewType == 'RECTO_VERSO' and viewPages.selectedRightPage!=null}" >
							<span class="quad_area1 splitBlockHeader">
								<span class="quad_area0_p4 lineToolSection">
									<h:outputLabel styleClass="free_label sectionTool" value="#{lbl.view_dtls_page_txt} #{viewPages.volume.pages.indexOf(viewPages.selectedRightPage)+1} #{lbl.toc_edit_of} #{utilBean.getListSize(viewPages.volume.pages)}"/>
								</span>
							</span>
						</h:panelGroup>
						</ui:remove>
						
						<h:panelGroup layout="block" styleClass="eg3_container_1_2 fulltext" rendered="#{viewPages.viewType == 'FULLTEXT'}">
							<h:outputStylesheet name="tei.css" library="cssFramework" target="head"/>
							<ui:remove>
							<span class="quad_area1 splitBlockHeader"></span>
							</ui:remove>
							<style type="text/css">
			                    ins{
			                        text-align:right;
			                        font-style:italic;
			                        display:inline-block;
			                        float:right;
			                        text-decoration:none;
			                    }
		                    </style>
							
							<div id="fulltext" class="quad_area1 splitBlockBody noTopBorder sameHeightSlave" style="background-color: white">
								<h:outputText value="#{volumeUtilBean.emphasizeWordsinHtml(viewPages.xhtmlForPage, viewPages.fulltextMatchesAsArray, 'searchHit')}" escape="false" rendered="#{viewPages.volume.teiSd!=null}"/>
							</div>
						</h:panelGroup>	
						
						<!--provenance and url  -->
						<h:panelGroup layout="block" styleClass="eg3_dualView eg3_image_bgColor_1 eg3_container_1">
							<h:panelGroup layout="block" styleClass="eg3_permalinkBox eg3_container_1_2 eg3_borderradius_5_top" 
							              rendered="#{viewPages.selectedPage!=null}">
								<h:inputText styleClass="eg3_permalinkBoxText" 
											  value="#{applicationBean.domain}/#{applicationBean.contextPath}/view/#{viewPages.volumeId}/single/#{viewPages.volume.pages.indexOf(viewPages.selectedPage)+1}" readonly="true" /> 
							</h:panelGroup>
							<h:panelGroup layout="block" styleClass="eg3_permalinkBox eg3_container_1_2 eg3_borderradius_5_top eg3_floatRight" 
							              rendered="#{viewPages.selectedRightPage!=null}">
								<h:inputText styleClass="eg3_permalinkBoxText" 
								              value="#{applicationBean.domain}/#{applicationBean.contextPath}/view/#{viewPages.volumeId}/single/#{viewPages.volume.pages.indexOf(viewPages.selectedRightPage)+1}" readonly="true" /> 
							</h:panelGroup>
						</h:panelGroup>											
					</h:panelGroup>
					
				</h:panelGroup>
				
				
			</h:panelGroup> <ui:remove>end eg3_viewPageContainer</ui:remove>
		</ui:define>
	</ui:composition>
</html>
