<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:fu="http://java.sun.com/jsf/composite/components/fileUpload"
	xmlns:mpdl="http://java.sun.com/jsf/composite/components/mpdl">


<ui:composition template="templates/template.xhtml">
	
	<ui:define name="mainContent">
			
			<!-- 
			<mpdl:paginator paginatorBean="#{testPaginatorBean}">
				<h:outputText value="#{var}"/>
			</mpdl:paginator>
			-->
			
			<h:outputText value="#{session.id}"/>
			<h:outputText value="#{facesContext.viewRoot.viewId}"/>
			
			<fu:fileUpload rerender="form1:info" fileUploadListener="#{fileUploadBeanNew.fileUploaded}">
			</fu:fileUpload>
			
			
			
			
			
			
			
			
			<h:panelGroup id="test"></h:panelGroup>
			

			
			
			<!-- Drag&Drop Panel -->
			<style>
				.accept {
					background-color:green;
				}
				.reject {
					background-color:red;
				}
				.default {

				}
			</style>
			<rich:dragIndicator id="ind" acceptClass="accept" rejectClass="reject" draggingClass="default">
       			 Drag the item to proper area..
  		  </rich:dragIndicator>
			
			<h:panelGroup id="info">
			
			
			<a4j:outputPanel id="dragDropTable" layout="block" style="height:400px;width:500px;">
			 	
			 	
			 	<a4j:outputPanel id="dropPanelFirst" layout="block" style="height:10px; background-color:grey" styleClass="dropPanel">
					<rich:dropTarget acceptedTypes="file" dropValue="pos0"
                    		dropListener="#{fileUploadBeanNew.processDrop}"
                    		render="dragDropTable" />
                    </a4j:outputPanel>
	            <a4j:repeat value="#{fileUploadBeanNew.files}" var="file" id="table"
	                style="height:300px; width:500px;" rowKeyVar="row">
	                <a4j:outputPanel layout="block" style="background-color:lightgrey">
	                    	<rich:dragSource type="file" dragValue="#{file}" dragIndicator="ind"/>
                    		 <a4j:mediaOutput element="img" cacheable="false" id="img" createContent="#{fileUploadBeanNew.paint}" value="#{row}" mimeType="image/jpeg" alt="img" style="height:50px;"/>
                    		 <h:outputText value="#{row + 1}"/>
                    		 <h:inputText value="#{fileUploadBeanNew.moveTo}">
                    		 	<f:ajax event="keyup" listener="#{fileUploadBeanNew.changeOrder(file)}" render=":form1:dragDropTable"/>
                    		 </h:inputText>
                    		 
                    		<h:outputText value="#{file.name}" />
	                 </a4j:outputPanel>
	                 <a4j:outputPanel id="dropPanel" layout="block" style="height:10px; background-color:grey" styleClass="dropPanel">
	                 <rich:dropTarget acceptedTypes="file" dropValue="#{file}"
                    		dropListener="#{fileUploadBeanNew.processDrop}"
                    		render="dragDropTable" />
                    </a4j:outputPanel>
	
	            </a4j:repeat>
	            
    		</a4j:outputPanel>
    		</h:panelGroup>

			
				<h:commandButton action="#{fileUploadBeanNew.save}" value="Save" />
			

	<ui:remove>
			<h:panelGroup id="info" layout="block">
                <rich:panel bodyClass="info">
                    <f:facet name="header">
                        <h:outputText value="Uploaded Files Info" />
                    </f:facet>
                    <h:outputText value="No files currently uploaded"
                        rendered="#{fileUploadBeanNew.size==0}" />
                    <rich:dataGrid columns="1" value="#{fileUploadBeanNew.files}"
                        var="file" rowKeyVar="row">
                        <rich:panel bodyClass="rich-laguna-panel-no-header">
                            <h:panelGrid columns="2">
                                <a4j:mediaOutput element="img" mimeType="image/jpeg"
                                    createContent="#{fileUploadBeanNew.paint}" value="#{row}"
                                    style="width:100px; height:100px;" cacheable="false">
                                </a4j:mediaOutput>
                                <h:panelGrid columns="2">
                                    <h:outputText value="File Name:" />
                                    <h:outputText value="#{file.name}" />
                                    <h:outputText value="File Length(bytes):" />
                                    <h:outputText value="#{file.size}" />
                                </h:panelGrid>
                            </h:panelGrid>
                        </rich:panel>
                    </rich:dataGrid>
                </rich:panel>
                <br />
                <a4j:commandButton action="#{fileUploadBean.clearUploadData}"
                    render="info, upload" value="Clear Uploaded Data"
                    rendered="#{fileUploadBean.size>0}" />
            </h:panelGroup>
            </ui:remove>
	</ui:define>

</ui:composition>

</html>
