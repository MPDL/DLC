<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:fu="http://java.sun.com/jsf/composite/components/fileUpload"
	xmlns:mpdl="http://java.sun.com/jsf/composite/components/mpdl">


<ui:composition template="templates/template.xhtml">
	
	<ui:define name="mainContent">
			
			<!-- 
			<mpdl:paginator paginatorBean="#{testPaginatorBean}">
				<h:outputText value="#{var}"/>
			</mpdl:paginator>
			-->
			
			
			<rich:panel>
				<h:selectOneMenu value="#{ingestBean.selectedContextId}">
						<f:selectItems value="#{ingestBean.contextSelectItems}"/>
				</h:selectOneMenu>
			 
				<a4j:commandButton action="#{ingestBean.save}" value="#{lbl.btn_create}" render="messages modsInfo" execute="@all" onbegin="#{rich:component('popup')}.show()" oncomplete="#{rich:component('popup')}.hide()">
					<!-- <rich:componentControl event="begin" target="popup" operation="show"/>-->
				</a4j:commandButton>
				
				

			    <rich:popupPanel id="popup" modal="true" resizeable="false">
			        <f:facet name="header">
			            <h:outputText value="Upload in progress" />
			        </f:facet>
			        <f:facet name="controls">
			        </f:facet>
			        <p>Images are uploaded and processed</p>
			        <p>Please be patient, this process may take several minutes</p>
			    </rich:popupPanel>
				
				
			</rich:panel>
			
			<rich:panel header="Upload your files...">
			
				<fu:fileUpload rerender="form1:imageInfo form1:modsInfo form1:teiInfo" fileUploadListener="#{ingestBean.fileUploaded}">
				</fu:fileUpload>
			
			</rich:panel>
			

			<rich:panel id="modsInfo" header="Metadata Information">
				<h:outputText value="#{ingestBean.mabFile.name}"/>
				
				<mpdl:modsEditor modsMetadata="#{ingestBean.modsMetadata}"/>

			
			</rich:panel>
			
			<rich:panel id="teiInfo" header="TEI Information">
				<h:outputText value="#{ingestBean.teiFile.name} - Found #{ingestBean.numberOfTeiPbs} scan references"/>
			
			</rich:panel>
			
		
			
			
			
			<rich:panel id="imageInfo">
	                    <f:facet name="header">
	                        <h:outputText value="Uploaded Images" />
	                    </f:facet>
	                    <h:outputText value="No files currently uploaded"
	                        rendered="#{ingestBean.size==0}" />
	                    <rich:dataGrid columns="1" value="#{ingestBean.imageFiles}"
	                        var="file" rowKeyVar="row">
	                        <rich:panel bodyClass="rich-laguna-panel-no-header">
	                            <h:panelGrid columns="2">
	                                <a4j:mediaOutput element="img" mimeType="image/jpeg"
	                                    createContent="#{ingestBean.paint}" value="#{row}"
	                                    style="width:50px; height:50px;" cacheable="false">
	                                </a4j:mediaOutput>
	                                <h:panelGrid columns="2">
	                                    <h:outputText value="File Name:" />
	                                    <h:outputText value="#{file.name}" />
	                                    <h:outputText value="File Length(bytes):" />
	                                    <h:outputText value="#{file.size}" />
	                                </h:panelGrid>
	                            </h:panelGrid>
	                        </rich:panel>
	                    </rich:dataGrid>
	                <br />
	                <a4j:commandButton action="#{fileUploadBean.clearUploadData}"
	                    render="info, upload" value="Clear Uploaded Data"
	                    rendered="#{fileUploadBean.size>0}" />
	          
			
				</rich:panel>
			
			
			
			
			
			
			
			
			<h:panelGroup id="test"></h:panelGroup>
			

			
			
			
	</ui:define>

</ui:composition>

</html>
